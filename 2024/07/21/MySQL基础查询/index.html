<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        MySQL基础查询 | Watch
      
    </title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/logo-rainbow.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/logo-rainbow32x32.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/logo-rainbow16x16.png" />
    
    
      <link rel="mask-icon"
            href="/images/logo-rainbow.svg"
            color="" />
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/normal.ttf);
        font-weight: normal;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css' />
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    
      <div id="search-mask" style="display:none">
  <div class="search-main" id="search-main">
    <div class="search__head">
      <div class="search-form">
        <svg t="1706347533072"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="7828"
             width="20"
             height="20">
          <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
          </path>
        </svg>
        <input id="search-input" placeholder="搜索文章">
        <svg t="1706361500528"
             id="search-close"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="4351"
             width="20"
             height="20">
          <path d="M512 562.688l-264.2944 264.2944-50.688-50.688L461.312 512 197.0176 247.7056l50.688-50.688L512 461.312l264.2944-264.2944 50.688 50.688L562.688 512l264.2944 264.2944-50.688 50.688L512 562.688z" fill="#00" p-id="4352">
          </path>
        </svg>
      </div>
    </div>
    <div class="search__body" id="search-result"></div>
    <div class="search__foot"></div>
  </div>
</div>

    
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo-rainbow.svg" />
        </a>
        <input id="navBtn" type="checkbox" />
        <div class="nav-right">
          
            <div class="search-outer">
  <div class="search" id="search-btn">
    <svg t="1706347533072"
         class="icon"
         viewBox="0 0 1024 1024"
         version="1.1"
         xmlns="http://www.w3.org/2000/svg"
         p-id="7828"
         width="20"
         height="20">
      <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
      </path>
    </svg>
    <span>搜索</span>
    <span class="search-shortcut-key">Ctrl K</span>
  </div>
</div>

          
          <div class="nav-menu">
            
              
                <a class="nav-menu-item" href="/classical_poems">古典诗词</a>
              
                <a class="nav-menu-item" href="/computer_technology">技术文档</a>
              
                <a class="nav-menu-item" href="/what_i_see">我看见</a>
              
            
            
          </div>
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">MySQL基础查询</div>
        <div class="post-info">
          
  <a href="/tags/MySQL/" class="post-tag">#MySQL</a>


          <span class="post-date">2024-07-21</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="post-toc-text">基本结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%81%94%E7%BB%93"><span class="post-toc-text">多表联结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="post-toc-text">常用函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="post-toc-text">聚合函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="post-toc-text">字符串函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="post-toc-text">数学函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="post-toc-text">日期函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="post-toc-text">窗口函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E5%87%BD%E6%95%B0"><span class="post-toc-text">控制流函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="post-toc-text">其他函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%BB%84%E5%90%88"><span class="post-toc-text">组合</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text"></span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D"><span class="post-toc-text">字符串匹配</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#LIKE-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="post-toc-text">LIKE 关键字</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="post-toc-text">使用字符串函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="post-toc-text">正则表达式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4"><span class="post-toc-text">使用聚合函数过滤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AVG"><span class="post-toc-text">AVG</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AE%A1%E6%95%B0"><span class="post-toc-text">条件计数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%86%E7%BB%84"><span class="post-toc-text">分组</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#-1"><span class="post-toc-text"></span></a></li></ol></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> selection_list <span class="hljs-comment">/*要查询的字段，多个字段用逗号隔开*/</span><br><span class="hljs-keyword">from</span> table_list <span class="hljs-comment">/*要查询的表名称*/</span><br>[<span class="hljs-keyword">where</span> <span class="hljs-keyword">condition</span> <span class="hljs-comment">/*筛选记录的条件*/</span><br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> grouping_clounms <span class="hljs-comment">/*对结果进行分组*/</span><br> <span class="hljs-keyword">having</span> <span class="hljs-keyword">condition</span> <span class="hljs-comment">/*对分组后的记录进行条件筛选*/</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> cloumns <span class="hljs-comment">/*对结果进行排序*/</span><br> limit  <span class="hljs-comment">/*对记录总数进行限定*/</span>]<br></code></pre></td></tr></table></figure>

<ul>
<li>select后面可以是表中的字段，常量值，表达式，函数；查询的结果是一个虚拟的表格；</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">nhaodghnl<br>asdglkjh<br></code></pre></td></tr></table></figure>



<p>1，基础查询，查询所有的列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu;<br><span class="hljs-comment">-- 指定字段进行查询</span><br><span class="hljs-keyword">SELECT</span> sid,sname <span class="hljs-keyword">FROM</span> t_stu;<br></code></pre></td></tr></table></figure>

<p>2，条件查询</p>
<ul>
<li>按条件表达式筛选，&gt;  &lt;  &#x3D;  !&#x3D;  &lt;&gt;（不等于）  &gt;&#x3D; &lt;&#x3D;</li>
<li>逻辑表达式筛选 &amp;&amp;（and） || (or)！ <strong>and ,or,not(取反)</strong></li>
<li>模糊查询 like，between and（not between and） ,in(列表中的值不支持通配符), is null(is not null)<ul>
<li>null使用is</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 指定某一个条件进行查询</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> courseid<span class="hljs-operator">=</span><span class="hljs-number">2</span> <br><span class="hljs-comment">-- AND 是两个条件都要满足</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> courseid<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>;<br><span class="hljs-comment">-- OR是条件只要满足一个就行</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> courseid<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">OR</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>;<br><span class="hljs-comment">-- 查询sid为 1，6，8的记录，属于某个集合</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sid <span class="hljs-keyword">IN</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>);<br><span class="hljs-comment">-- 查询sid不属于 1，6，8的记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sid  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>);<br><span class="hljs-comment">-- 查询记录某个字段为null </span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span>  tb_stu <span class="hljs-keyword">WHERE</span> updatetime <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-comment">--  查询成绩在70到90区间范围内的记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> score <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">70</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">90</span>;<br><span class="hljs-comment">-- 性别非男的记录</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;m&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;m&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>3，模糊查询，处理字符类型 like</p>
<p>%：表示0或任意多个字符</p>
<p>_:任意一个字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 名字由3个字母组成</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;___&#x27;</span>;<br><span class="hljs-comment">-- 名字由j 开头</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;j%&#x27;</span>;<br><span class="hljs-comment">-- 第二个字母为a 的学生记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;_a%&#x27;</span>;<br><span class="hljs-comment">-- 查询姓名中包含字母a的记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>4，去重查询&amp;起别名</p>
<ul>
<li>表或者字段还可以起别名，起别名是便于理解，如果查询的字段有重名情况使用别名可以区分，AS可省略 使用空格</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--  查询学生表中的所有性别</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> sgender <span class="hljs-keyword">FROM</span> t_stu ;<br><span class="hljs-comment">-- 给查询出的字段起别名 AS是可以省略的 使用空格</span><br><span class="hljs-keyword">SELECT</span> age <span class="hljs-keyword">AS</span> 年龄,sname <span class="hljs-keyword">AS</span> 姓名 <span class="hljs-keyword">FROM</span>  tb_stu;<br><span class="hljs-keyword">SELECT</span> sid a,sname b,sgender gender,score c <span class="hljs-keyword">FROM</span> t_stu;<br></code></pre></td></tr></table></figure>

<p>5，排序 order by子句可以跟单个字段，多个字段，表达式，函数，别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询所有学生记录，按成绩进行降序排序</span><br><span class="hljs-comment">-- 缺省是ASC升序</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>;<br><span class="hljs-comment">-- 查询所有学生记录，首先先按成绩进行降序排序，如果成绩相同，按名字进行升序排序</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>, sname <span class="hljs-keyword">ASC</span>;<br></code></pre></td></tr></table></figure>

<p>6，组函数&#x2F;聚合函数&#x2F;分组函数(方法，已经封装好的功能直接调用)</p>
<p>用作统计使用，又称为聚合函数或者统计函数或者组函数</p>
<ul>
<li><p>聚合函数是用来做<strong>纵向运算</strong>的函数：</p>
</li>
<li><p>COUNT(字段)：统计指定列不为NULL的记录行数；一般使用count（*）统计行数</p>
</li>
<li><p>MAX(字段)：计算指定列的最大值，如果指定列是字符串类型，那么使用字符串排序运算；</p>
</li>
<li><p>MIN(字段)：计算指定列的最小值，如果指定列是字符串类型，那么使用字符串排序运算；</p>
</li>
<li><p>SUM(字段)：计算指定列的数值和，如果指定列类型不是数值类型，那么计算结果为0；</p>
</li>
<li><p>AVG(字段)：计算指定列的平均值，如果指定列类型不是数值类型，那么计算结果为0；</p>
</li>
</ul>
<p>sum,avg一般处理数值型,</p>
<p>max，min,count可以处理任意数据类型</p>
<p>分组函数都忽略了null值，可以和distinct搭配使用</p>
<p><strong>注意点：</strong>组函数可以出现多个，但是不能嵌套；如果没有group by 子句，结果集中所有行数作为一组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询emp表中有佣金的人数,统计指定列不为NULL的记录行数</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(comm) a <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- SELECT 200+null;</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(empno) 总人数 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) 总人数 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) 总人数 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- 查询emp表中有佣金的人数</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(comm) <span class="hljs-keyword">from</span> emp;<br><span class="hljs-comment">-- 查询emp表中月薪大于2500的人数：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span><span class="hljs-number">2500</span>;<br><span class="hljs-comment">-- 统计月薪与佣金之和大于2500元的人数： ifnull(表达式1，表达式2)  如果表达式1为null那么取表达式2的值，否则取表达式1的值</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">+</span>ifnull(comm,<span class="hljs-number">0</span>) <span class="hljs-operator">&gt;</span><span class="hljs-number">2500</span>;<br><span class="hljs-comment">--查询有佣金的人数，以及有领导的人数：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(comm) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> mgr <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-comment">-- 查询所有雇员月薪和：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(sal) 总薪资  <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- 查询所有雇员月薪和，以及所有雇员佣金和：</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(sal) 总薪资,<span class="hljs-built_in">SUM</span>(comm) 总佣金 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- 查询所有雇员月薪+佣金和</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(sal<span class="hljs-operator">+</span>ifnull(comm,<span class="hljs-number">0</span>)) 总佣金 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">sum</span>(sal)<span class="hljs-operator">+</span><span class="hljs-built_in">sum</span>(ifnull(comm,<span class="hljs-number">0</span>)) 总佣金 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- 统计所有员工平均工资</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">avg</span>(sal) 平均薪资 <span class="hljs-keyword">FROM</span> emp;<br><span class="hljs-comment">-- 查询最高工资和最低工资</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">max</span>(sal),<span class="hljs-built_in">min</span>(sal) <span class="hljs-keyword">FROM</span> emp;<br></code></pre></td></tr></table></figure>

<p>7，group by分组查询</p>
<p>查询出来的字段要求是group by后的字段，<strong>查询字段中可以出现组函数和分组字段</strong></p>
<p>group by后面可以跟聚合函数 可以起别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 	查询每个部门的部门编号和每个部门的工资和</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">SUM</span>(sal) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br><span class="hljs-comment">-- 	查询每个部门的部门编号以及每个部门的人数</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">SUM</span>(sal),<span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br><span class="hljs-comment">-- 	查询每个部门的部门编号以及每个部门员工工资大于1500的人数：</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span><span class="hljs-number">1500</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br></code></pre></td></tr></table></figure>

<p>按多个字段分组，后面字段一致的为一组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 按job进行分类</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),job <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job;<br><span class="hljs-comment">-- 按job和mgr进行分类</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),job,mgr <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job,mgr;<br></code></pre></td></tr></table></figure>

<p>8，having子句</p>
<p>where是对分组前进行过滤；having是对分组后进行过滤</p>
<p><strong>where中不能出现分组&#x2F;聚合函数</strong>，having中可以出现</p>
<p>where是比分组先执行的，having是在分组之后执行的；</p>
<p> having后面可以跟别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询工资总和大于9000的部门编号以及工资和：</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">sum</span>(sal)  <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">sum</span>(sal)<span class="hljs-operator">&gt;</span><span class="hljs-number">9000</span>;<br><span class="hljs-comment">-- having中使用别名</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">sum</span>(sal) 总薪资 <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> 总薪资<span class="hljs-operator">&gt;</span><span class="hljs-number">9000</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询部门员工个数大于3的，having中使用了别名</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) cc,deptno <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> cc<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<p>9，limit </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 第一位表示起始索引位置（从0开始），第二位表示个数；在分页中会使用</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">5</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">5</span>; 等价与 <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure>

<p>select完整语法使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>),<span class="hljs-built_in">sum</span>(sal) allsum <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span><span class="hljs-number">1500</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">sum</span>(sal)<span class="hljs-operator">&gt;</span><span class="hljs-number">7000</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> allsum <span class="hljs-keyword">desc</span> LIMIT <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<p>10，多表查询&#x2F;关联查询</p>
<p>内连接</p>
<ul>
<li><p>多表等值连接的结果是多表的交集部分，N表连接，至少需要N-1个连接条件，没有顺序要求，一般起别名</p>
</li>
<li><p>非等值连接，只要不是等号连接的都是非等值连接</p>
</li>
</ul>
<p>外连接，有主表有从表，主表肯定会显示完整的内容</p>
<ul>
<li><p>左外连接，以左表为主</p>
</li>
<li><p>右外连接，以右表为主</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询员工信息，要求显示员工号，姓名，月薪，部门名称</span><br><span class="hljs-comment">-- 笛卡尔积 （a, b） (1,2,3) --(a,1) (a,2) (a,3) (b,1) (b,2) (b,3)--》会生成一个中间表</span><br><span class="hljs-comment">-- 多表查询，关联条件使用的是等号</span><br><span class="hljs-comment">-- 查询员工信息，要求显示员工号，姓名，月薪，部门名称  等值连接</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,emp.deptno,dname <span class="hljs-keyword">FROM</span> emp,dept <span class="hljs-keyword">WHERE</span> emp.deptno<span class="hljs-operator">=</span>dept.deptno;<br><span class="hljs-comment">-- 给表起别名</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,a.deptno,dname <span class="hljs-keyword">FROM</span> emp a,dept b <span class="hljs-keyword">WHERE</span> a.deptno<span class="hljs-operator">=</span>b.deptno;<br><span class="hljs-comment">-- 非等值连接</span><br><span class="hljs-comment">-- 查询员工信息，要求显示：员工号，姓名，月薪，薪水的级别</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,GRADE <span class="hljs-keyword">FROM</span> emp e,salgrade sa <span class="hljs-keyword">WHERE</span> e.sal <span class="hljs-keyword">BETWEEN</span> sa.LowSAL <span class="hljs-keyword">AND</span> sa.HISAL; <br><br><span class="hljs-comment">-- 内连接&amp;外连接</span><br><span class="hljs-comment">-- 查询员工信息，要求显示员工号，姓名，月薪，部门名称 使用内连接和等值连接等同</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,emp.deptno,dname <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> dept <span class="hljs-keyword">on</span> emp.deptno<span class="hljs-operator">=</span>dept.deptno;<br><span class="hljs-comment">-- 左外连接 左边的表内容全部显示，右边的表没有的以null进行填充</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,emp.deptno,dname <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept <span class="hljs-keyword">on</span> emp.deptno<span class="hljs-operator">=</span>dept.deptno;<br><span class="hljs-comment">-- 右外连接，右表内容全部显示，左表没有的以null进行填充</span><br><span class="hljs-keyword">SELECT</span> empno,ename,sal,emp.deptno,dname <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> dept <span class="hljs-keyword">on</span> emp.deptno<span class="hljs-operator">=</span>dept.deptno;<br><br></code></pre></td></tr></table></figure>

<p> ON后面的条件（ON条件）和WHERE条件的区别：</p>
<p>​		ON条件：是过滤两个链接表笛卡尔积形成中间表的约束条件。</p>
<p>​		WHERE条件：在没有ON的单表查询中，是限制物理表或者中间查询结果返回记录的约束。在两表或多表连	接中是限制连接形成最终中间表的返回结果的约束。<br>​建议：<br>​		ON只进行连接操作，WHERE只过滤中间表的记录</p>
<p>11，自连接，通过别名，将同一张表视为多张表；同一张表中某个字段要去关联另外一个字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询员工姓名和员工的老板的名称</span><br><span class="hljs-keyword">SELECT</span> e1.empno,e1.ename,e2.empno,e2.ename  <span class="hljs-keyword">FROM</span> emp e1, emp e2 <span class="hljs-keyword">WHERE</span> e1.mgr<span class="hljs-operator">=</span>e2.empno;<br></code></pre></td></tr></table></figure>

<p>12，子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询工资为20号部门平均工资的员工信息</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sal) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">20</span>);<br></code></pre></td></tr></table></figure>

<h2 id="多表联结"><a href="#多表联结" class="headerlink" title="多表联结"></a>多表联结</h2><p>单纯做匹配连接用 join</p>
<p>需要得到笛卡尔积用 cross join</p>
<p>连接时需要某个表全部保留用 left join</p>
<h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p><strong>注意：</strong>MySQL中的+就只有运算符的功能；会试图将字符型数值转换为数值型再继续操作，转换失败则转为0；若其中有null则结果为null；字符串可以使用concat函数拼接；</p>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>除去常见的min ,max ,count ,avg,sum</p>
<p><strong>group_concat(arg)</strong></p>
<p>常常搭配 group by 使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 单列合并，默认以逗号分隔<br><span class="hljs-keyword">select</span> a,<br>    group_concat(name) <span class="hljs-keyword">as</span> tn<br><span class="hljs-keyword">from</span> t <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> id;<br><br># 使用指定符号<br><span class="hljs-keyword">select</span> a,<br>    group_concat(name separator <span class="hljs-string">&#x27;;&#x27;</span>) <span class="hljs-keyword">as</span> tn<br><span class="hljs-keyword">from</span> t <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> id;<br></code></pre></td></tr></table></figure>



<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>length(str)得到的是字节个数 utf8中 中文是3个字节</p>
<p>concat() 拼接字符串</p>
<p>upper &#x2F;lower（str)</p>
<p>substr,substring 截取字串 MySQL的索引是从1开始的，截取的是字符长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SUBSTR(string, start, length)<br>其中 string 是要从中提取的原始字符串，start 是开始提取的位置（位置从 1 开始计数），length 是要提取的字符数。如果省略 length，则从 start 位置开始提取直到字符串的末尾。<br></code></pre></td></tr></table></figure>



<p>instr(str,substr)返回字串第一次出现的索引，找不到则为0</p>
<p>trim（）</p>
<p>replace 替换全部符合的字符</p>
<p><code>ASCII(char)</code>返回字符的ASCII码值</p>
<p>CONCAT(s1,s2…,sn)&#96;将s1,s2…,sn连接成字符串</p>
<p>CONCAT_WS(sep,s1,s2…,sn)&#96;将s1,s2…,sn连接成字符串，并用sep字符间隔</p>
<p>INSERT(str,x,y,instr) &#96;将字符串str从第x位置开始，y个字符长的子串替换为字符串instr，返回结果</p>
<p>FIND_IN_SET(str,list)&#96;分析逗号分隔的list列表，如果发现str，返回str在list中的位置</p>
<p>LCASE(str)或LOWER(str) &#96;返回将字符串str中所有字符改变为小写后的结果</p>
<p>LEFT(str,x)&#96;返回字符串str中最左边的x个字符</p>
<p>LENGTH(s)&#96;返回字符串str中的字符数</p>
<p><code>LTRIM(str) </code>从字符串str中切掉开头的空格</p>
<p>POSITION(substr,str)&#96; 返回子串substr在字符串str中第一次出现的位置</p>
<p>QUOTE(str) &#96;用反斜杠转义str中的单引号</p>
<p>REPEAT(str,srchstr,rplcstr)&#96;返回字符串str重复x次的结果</p>
<p>REVERSE(str) &#96;返回颠倒字符串str的结果</p>
<p>RIGHT(str,x) &#96;返回字符串str中最右边的x个字符</p>
<p>RTRIM(str)&#96; 返回字符串str尾部的空格</p>
<p>STRCMP(s1,s2)&#96;比较字符串s1和s2</p>
<p>TRIM(str)&#96;去除字符串首部和尾部的所有空格</p>
<p>UCASE(str)<code>或</code>UPPER(str) &#96;返回将字符串str中所有字符转变为大写后的结果</p>
<p><strong>sql中的索引是从1开始的</strong></p>
<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><p>**ABS(x)<strong>：返回x的绝对值，</strong>SQRT(x)**：返回一个数的平方根</p>
<p>**BIN(x)**：返回x的二进制，OCT返回八进制，HEX返回十六进制</p>
<p>**CEILING(x)<strong>：返回大于x的最小整数值，</strong>FLOOR(x)**：返回小于x的最大整数值</p>
<p>**POW(x,y)<strong>：返回x的y次方，</strong>EXP(x)**：返回e的x次方</p>
<p>**GREATEST(x1,x2,…,xn)<strong>：返回集合中最大的值，</strong>LEAST(x1,x2,…,xn)**：返回集合中最小的值</p>
<p>**LOG(x,y)<strong>：返回x的以y为底的对数，</strong>LN(x)**：返回x的自然对数</p>
<p>**MOD(x,y)**：返回x&#x2F;y的模（余数）</p>
<p>**PI()**：返回pi的值（圆周率）</p>
<p>**RAND()**：返回０到１内的随机值,可以通过提供一个参数(种子)使RAND()随机数生成器生成一个指定的值。</p>
<p>**ROUND(x,y)**：返回参数x的四舍五入的有y位小数的值</p>
<p>**SIGN(x)**：返回代表数字x的符号的值</p>
<p>**TRUNCATE(x,y)**：返回数字x截短为y位小数的结果</p>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>now() 返回日期+时间</p>
<p>curdate()返回系统日期，不包含时间</p>
<p>curtime() 返回当前时间，不包含日期</p>
<p>year（)年 获取指定的年 month()   monthname() </p>
<p>str_to_date 将字符通过指定的格式转换为日期</p>
<p>date_format将日期转换为字符</p>
<p>datediff:返回两个日期相差天数  </p>
<p>**DATE()**函数，返回的格式为”YYYY-mm-dd”，</p>
<p>**TIME()**函数，用于提取时间字段的时间，例如t01的tdate为’2020-05-26 11:11:11’，返回的格式为”HH:ii:ss”</p>
<p>提取日期</p>
<p>**YEAR()**函数，用于提取时间字段的年返回的格式为”YYYY”</p>
<p>**MONTH()**函数，用于提取时间字段的月，返回的格式为”mm”，若月份前有0会忽略</p>
<p>**DAY()**函数，用于提取时间字段的日期，返回的格式为”dd”，若日期前有0会忽略</p>
<p>**HOUR()**函数，用于提取时间字段的小时，返回的格式为”HH”，若小时前有0会忽略</p>
<p>**MINUTE()**函数，用于提取时间字段的分钟，返回的格式为”ii”，若分钟前有0会忽略</p>
<p>**SECOND()**函数，用于提取时间字段的秒，返回的格式为”ss”，若秒前有0会忽略</p>
<p>日期计算</p>
<p>**TIMESTAMPDIFF(interval, time_start, time_end)**可计算time_start-time_end的时间差，单位以指定的interval为准，常用可选：</p>
<p>SECOND 秒，MINUTE 分钟（返回秒数差除以60的整数部分，HOUR 小时（返回秒数差除以3600的整数部分，DAY 天数（返回秒数差除以3600*24的整数部分，MONTH 月数，YEAR 年数</p>
<p>DATE_SUB(date, INTERVAL 1 DAY)</p>
<p>DATEDIFF(datepart,expr1,expr2)</p>
<p>返回 expr1 - expr2</p>
<p>#datepart表示返回的日期差值类型，可以是年，月，日，默认是天（可以只写两个参数）<br>#expr1表示开始日期<br>#expr2表示结束日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 当前日期，当前时间，日期和时间</span><br><span class="hljs-keyword">SELECT</span> CURDATE(),CURTIME(),now();<br><span class="hljs-comment">-- 指定日期是一年中的第几周</span><br><span class="hljs-keyword">SELECT</span> WEEK(now());<br><span class="hljs-comment">-- 返回指定日期的年份</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">YEAR</span>(now());<br><span class="hljs-comment">-- 返回指定时间的小时</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">hour</span>(now()),<span class="hljs-keyword">hour</span>(CURTIME());<br><span class="hljs-comment">-- 返回date的月份名</span><br><span class="hljs-keyword">SELECT</span> MONTHNAME(now());<br><span class="hljs-comment">-- 计算时间相隔的天数</span><br><span class="hljs-keyword">SELECT</span> DATEDIFF(<span class="hljs-string">&#x27;2021-1-15&#x27;</span>,<span class="hljs-string">&#x27;2021-1-12&#x27;</span>);<br><span class="hljs-keyword">SELECT</span> DATEDIFF(now(),<span class="hljs-string">&#x27;2021-1-10&#x27;</span>);<br><span class="hljs-comment">-- 把日期按指定的格式进行转换</span><br><span class="hljs-keyword">SELECT</span> DATE_FORMAT(now(),<span class="hljs-string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);<br><span class="hljs-comment">-- 把字符串转日期</span><br><span class="hljs-keyword">SELECT</span> STR_TO_DATE(<span class="hljs-string">&#x27;2021-1-12&#x27;</span>,<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>);<br><span class="hljs-comment">-- 将毫秒数转换为时间格式</span><br><span class="hljs-keyword">SELECT</span> FROM_UNIXTIME(<span class="hljs-number">646545353</span>);<br></code></pre></td></tr></table></figure>



<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">[你要的操作] <span class="hljs-keyword">OVER</span> ( <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span>  <span class="hljs-operator">&lt;</span>用于分组的列名<span class="hljs-operator">&gt;</span><br>                    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">&lt;</span>按序叠加的列名<span class="hljs-operator">&gt;</span> <br>                    <span class="hljs-keyword">ROWS</span><span class="hljs-operator">|</span><span class="hljs-keyword">RANGE</span> <span class="hljs-operator">&lt;</span>窗口滑动的数据范围<span class="hljs-operator">&gt;</span> )<br><br></code></pre></td></tr></table></figure>

<p>&lt;窗口滑动的数据范围&gt; 用来限定 [你要的操作] 所运用的数据的范围，具体有如下这些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">当前 - current row<br>之前的 - preceding<br>之后的 - following<br>无界限 - unbounded<br>表示从前面的起点 - unbounded preceding<br>表示到后面的终点 - unbounded following<br><br>举例<br>取当前行和前五行：ROWS between 5 preceding and current row --共6行<br>取当前行和后五行：ROWS between current row and 5 following --共6行<br>取前五行和后五行：ROWS between 5 preceding and 5 following --共11行<br>取当前行和前六行：ROWS 6 preceding（等价于between...and current row） --共7行<br>这一天和前面6天：RANGE between interval 6 day preceding and current row --共7天<br>这一天和前面6天：RANGE interval 6 day preceding（等价于between...and current row） --共7天<br>字段值落在当前值-100到+200的区间：RANGE between 100 preceding and 200 following  --共301个数值<br><br></code></pre></td></tr></table></figure>

<p>排序函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">(<span class="hljs-number">1</span>) <span class="hljs-built_in">ROW_NUMBER</span>(): 依次排序，不会出现相同排名 <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span><br><br>(<span class="hljs-number">2</span>) <span class="hljs-built_in">RANK</span>(): 出现相同排名时，跳跃排序 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span><br><br>(<span class="hljs-number">3</span>) <span class="hljs-built_in">DENSE_RANK</span>(): 出现相同排名时，连续排序 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>











<h3 id="控制流函数"><a href="#控制流函数" class="headerlink" title="控制流函数"></a>控制流函数</h3><p>**IFNULL(arg1,arg2)**：如果arg1不是空，返回arg1，否则返回arg2</p>
<p>**NULLIF(arg1,arg2)**：如果arg1&#x3D;arg2返回NULL，否则返回arg1</p>
<p>**IF(test,t,f)**：如果test是真，返回t，否则返回f</p>
<p><strong>CASE [test]</strong><br><strong>WHEN<code> </code>[val 1]    THEN    [result 1]</strong><br><strong>WHEN<code> </code>[val 2]    THEN    [result 2]</strong><br><strong>WHEN<code> </code>[val 3]    THEN    [result 3]</strong><br><strong>……</strong><br><strong>WHEN<code> </code>[val n]    THEN    [result n]</strong><br><strong>ELSE     [default result]</strong><br><strong>END</strong></p>
<p>这里，参数test是要被判断的值或表达式，接下来的是一系列的<code>WHEN-THEN</code>块，每一块的第一个参数指定要比较的值，如果为真，就返回结果。</p>
<p>所有的WHEN-THEN块将以ELSE块结束，当END结束了所有外部的CASE块时，如果前面的每一个块都不匹配就会返回ELSE块指定的默认结果。</p>
<p>如果没有指定ELSE块，而且所有的WHEN-THEN比较都不是真，MySQL将会返回NULL。</p>
<p><strong>CASE</strong><br><strong>WHEN [conditional test 1]    THEN[result 1]<br>WHEN [conditional test 2]    THEN[result 2]</strong><br><strong>ELSE [default result]</strong><br><strong>END</strong></p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><p>version（） 版本号</p>
<p>user（）当前用户</p>
<h2 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h2><ul>
<li>union–将两个表做行拼接，同时自动删除重复的行。</li>
<li>union all—将两个表做行拼接，保留重复的行。</li>
<li>使用union组合查询时，只能使用一条order by字句，它必须位于最后一条select语句之后，因为对于结果集不存在对于一部分数据进行排序，而另一部分用另一种排序规则的情况。</li>
</ul>
<h2 id><a href="#" class="headerlink" title></a></h2><h2 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h2><h3 id="LIKE-关键字"><a href="#LIKE-关键字" class="headerlink" title="LIKE 关键字"></a>LIKE 关键字</h3><ul>
<li>包含：LIKE ‘%keyword%’</li>
<li>不包含：NOT LIKE ‘%keyword%’</li>
<li>先后顺序 LIKE ‘%keyword1%keyword2%’</li>
</ul>
<h3 id="使用字符串函数"><a href="#使用字符串函数" class="headerlink" title="使用字符串函数"></a>使用字符串函数</h3><ul>
<li>locate函数：Locate(substr,str) &gt; <code>0</code>，表示sub字符串包含str字符串，并返回位置，从1开始；Locate(substr,str) &#x3D; <code>0</code>，表示sub字符串不包含str字符串。</li>
<li>instr(filed,str)函数：返回str子字符串在filed字符串的第一次出现位置，为0则表示不包含该字符串</li>
</ul>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>使用regexp ‘正则表达式’;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>查询不以a，w，j开头的学生信息<br><span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> name regexp ‘<span class="hljs-operator">^</span>[<span class="hljs-operator">^</span>awj]’<br></code></pre></td></tr></table></figure>



<h2 id="使用聚合函数过滤"><a href="#使用聚合函数过滤" class="headerlink" title="使用聚合函数过滤"></a>使用聚合函数过滤</h2><h3 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">avg</span>(a2.timestamp <span class="hljs-operator">-</span>a1.timestamp )<br></code></pre></td></tr></table></figure>

<p>当然，使用sum()&#x2F;count()灵活度更加高</p>
<p>AVG括弧里直接加条件，过滤掉一些数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">avg</span>(rating<span class="hljs-operator">&lt;</span><span class="hljs-number">3</span>)<br># 只计算评分小于三的均值<br></code></pre></td></tr></table></figure>



<h2 id="条件计数"><a href="#条件计数" class="headerlink" title="条件计数"></a>条件计数</h2><p>常见的三形式</p>
<p>1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">count</span>(if(c.action<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">null</span>))<br></code></pre></td></tr></table></figure>

<p>当然，几乎所有使用if的地方可以替换为case end 表达式。</p>
<p>2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">sum</span>(if(c.action<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>))<br></code></pre></td></tr></table></figure>

<p>3</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">count</span>(col_value<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">null</span>)<br></code></pre></td></tr></table></figure>



<p>注意</p>
<ol>
<li>count里，只有字段值为null才不计数，其他都是计数的。</li>
<li>count 里面可以添加distinct 关键字，只计数不重复的值。</li>
</ol>
<p>举例：</p>
<p>如count(sex&#x3D; ‘男生’ or NULL) 这部分，为什么要加上or NULL，直接count(sex&#x3D;‘男生’)有什么问题吗？不就是要找sex&#x3D; ‘男生’的数据吗，为什么要计算NULL的数据。<br>因为当 sex不是男生时 sex&#x3D;‘男生’ 结果false。不是 NULL，count在值是NULL是不统计数， （count(‘任意内容’)都会统计出所有记录数，因为count只有在遇见null时不计数，即count(null)&#x3D;&#x3D;0，因此前者单引号内不管输入什么值都会统计出所有记录数），至于加上or NULL ， 很像其他编程里的or运算符，第一个表达式是true就是不执行or后面的表达式，第一个表达式是false 执行or后面的表达式 。当sex不为男生时sex&#x3D; ‘男生’ or NULL 的结果是NULL，Count才不会统计上这条记录数</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>可以使用自己构建的字段分组，以时间举例</p>
<p>字段为日期，包含年月日，如果按月分组，则需要先select 里形成月，然后group by里使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> date_format(trans_date,<span class="hljs-string">&#x27;%Y-%m&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">month</span>,country,<br><br> <span class="hljs-keyword">from</span> Transactions <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">month</span>,country<br></code></pre></td></tr></table></figure>

<p>当然，如果查询中不需要group by 或者 order by 分组所依据的字段，也可以直接在group by &#x2F;order by里写表达式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span>  country,<br><span class="hljs-keyword">from</span> Transactions <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> date_format(trans_date,<span class="hljs-string">&#x27;%Y-%m&#x27;</span>),country<br></code></pre></td></tr></table></figure>



<h3 id="-1"><a href="#-1" class="headerlink" title></a></h3>
      </div>
    </div>
    
      <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({"startOnload":true});
        }
      </script>
    
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2024/07/21/Z%E4%B8%8E%E8%BF%87%E5%8E%BB%EF%BC%881%EF%BC%89/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>Z与过去（1）</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2024/07/20/%E5%BA%8F%E8%A8%80/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
      </div>
      序言
    </a>
  
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              <div class="matts">天</div><div class="matts">接</div><div class="matts">云</div><div class="matts">涛</div><div class="matts">连</div><div class="matts">晓</div><div class="matts">雾</div>
            </div>
          
            <div class="foot-line">
              <div class="matts">星</div><div class="matts">河</div><div class="matts">欲</div><div class="matts">转</div><div class="matts">千</div><div class="matts">帆</div><div class="matts">舞</div>
            </div>
          
        </div>
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">朋友</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://www.mizu.ink/">Mizu</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MzkxNTYxODQ1NQ">神龟先生</a>
                  </div>
                
                <div class="text">
                  <img alt="link" height="20px" width="20px" src="/images/icon/icon-link+.svg" />
                  <a class="foot-link"
                     href="mailto:LookingForWatch@outlook.com?subject=%E7%94%B3%E8%AF%B7%20Hozen.site%20%E7%9A%84%E5%8F%8B%E9%93%BE%E4%BD%8D%E7%BD%AE">
                  申请友链</a>
                </div>
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/FindingWatch">FindingWatch</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/bilibili.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://space.bilibili.com/38815605?spm_id_from=333.1007.0.0">徙</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/outlook.svg" />
                <a class="foot-link" href="mailto:LookingForWatch@outlook.com">LookingForWatch@outlook.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="https://FindingWatch.github.io">Watch</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
      <script src="https://unpkg.com/js-polyfills@0.1.43/es6.js"></script>
      <script id="MathJax-script"
              async
              src="https://www.unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    
    
      <script src="/js/search.js"></script>
      <script>searchInitialize("/search.json")</script>
    
    
  

  </body>
</html>
