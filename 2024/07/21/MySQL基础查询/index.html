<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        MySQL基础查询 | Watch
      
    </title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/logo-rainbow.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/logo-rainbow32x32.png" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/logo-rainbow16x16.png" />
    
    
      <link rel="mask-icon"
            href="/images/logo-rainbow.svg"
            color="" />
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/normal.ttf);
        font-weight: normal;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css' />
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    
      <div id="search-mask" style="display:none">
  <div class="search-main" id="search-main">
    <div class="search__head">
      <div class="search-form">
        <svg t="1706347533072"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="7828"
             width="20"
             height="20">
          <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
          </path>
        </svg>
        <input id="search-input" placeholder="搜索文章">
        <svg t="1706361500528"
             id="search-close"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="4351"
             width="20"
             height="20">
          <path d="M512 562.688l-264.2944 264.2944-50.688-50.688L461.312 512 197.0176 247.7056l50.688-50.688L512 461.312l264.2944-264.2944 50.688 50.688L562.688 512l264.2944 264.2944-50.688 50.688L512 562.688z" fill="#00" p-id="4352">
          </path>
        </svg>
      </div>
    </div>
    <div class="search__body" id="search-result"></div>
    <div class="search__foot"></div>
  </div>
</div>

    
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo-rainbow.svg" />
        </a>
        <input id="navBtn" type="checkbox" />
        <div class="nav-right">
          
            <div class="search-outer">
  <div class="search" id="search-btn">
    <svg t="1706347533072"
         class="icon"
         viewBox="0 0 1024 1024"
         version="1.1"
         xmlns="http://www.w3.org/2000/svg"
         p-id="7828"
         width="20"
         height="20">
      <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
      </path>
    </svg>
    <span>搜索</span>
    <span class="search-shortcut-key">Ctrl K</span>
  </div>
</div>

          
          <div class="nav-menu">
            
              
                <a class="nav-menu-item" href="/classical_poems">古典诗词</a>
              
                <a class="nav-menu-item" href="/computer_technology">技术文档</a>
              
                <a class="nav-menu-item" href="/what_i_see">我看见</a>
              
            
            
          </div>
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">MySQL基础查询</div>
        <div class="post-info">
          
  <a href="/tags/MySQL/" class="post-tag">#MySQL</a>


          <span class="post-date">2024-07-21</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="post-toc-text">基本结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="post-toc-text">多表查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9B%86%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="post-toc-text">集合查询</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%87%BD%E6%95%B0"><span class="post-toc-text">函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="post-toc-text">聚合函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="post-toc-text">字符串函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="post-toc-text">数学函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="post-toc-text">日期函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="post-toc-text">窗口函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E5%87%BD%E6%95%B0"><span class="post-toc-text">控制流函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8B%93%E5%B1%95"><span class="post-toc-text">拓展</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E9%87%8C%E4%BD%BF%E7%94%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="post-toc-text">聚合函数里使用表达式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AE%A1%E6%95%B0"><span class="post-toc-text">条件计数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9E%84%E5%BB%BA%E7%9A%84%E5%AD%97%E6%AE%B5%E5%88%86%E7%BB%84"><span class="post-toc-text">使用构建的字段分组</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D"><span class="post-toc-text">字符串匹配</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#LeetCode%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="post-toc-text">LeetCode练习题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="post-toc-text">查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="post-toc-text">连接</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0-1"><span class="post-toc-text">聚合函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84"><span class="post-toc-text">排序和分组</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E5%92%8C%E8%BF%9E%E6%8E%A5"><span class="post-toc-text">高级查询和连接</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="post-toc-text">子查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="post-toc-text">字符串函数 &#x2F; 正则表达式</span></a></li></ol></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> selection_list <span class="hljs-comment">/*要查询的字段，多个字段用逗号隔开*/</span><br><span class="hljs-keyword">from</span> table_list <span class="hljs-comment">/*要查询的表名称*/</span><br>[<span class="hljs-keyword">where</span> <span class="hljs-keyword">condition</span> <span class="hljs-comment">/*筛选记录的条件*/</span><br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> grouping_clounms <span class="hljs-comment">/*对结果进行分组*/</span><br> <span class="hljs-keyword">having</span> <span class="hljs-keyword">condition</span> <span class="hljs-comment">/*对分组后的记录进行条件筛选*/</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> cloumns <span class="hljs-comment">/*对结果进行排序*/</span><br> limit  <span class="hljs-comment">/*对记录总数进行限定*/</span>]<br></code></pre></td></tr></table></figure>

<ul>
<li>select后面可以是表中的字段，常量值，表达式，函数；查询的结果是一个虚拟的表格；</li>
</ul>
<p>执行顺序：</p>
<p><strong>FROM</strong> - 确定数据源，执行表连接和子查询。</p>
<p><strong>WHERE</strong> - 筛选满足条件的记录。</p>
<p><strong>GROUP BY</strong> - 根据一个或多个列对结果进行分组。</p>
<p><strong>HAVING</strong> - 筛选分组后的结果集。</p>
<p><strong>SELECT</strong> - 投影选择所需的列。</p>
<p><strong>ORDER BY</strong> - 对结果集进行排序。</p>
<p><strong>LIMIT</strong> - 返回指定数量的记录。</p>
<p>基础查询，查询所有的列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu;<br><span class="hljs-comment">-- 指定字段进行查询</span><br><span class="hljs-keyword">SELECT</span> sid,sname <span class="hljs-keyword">FROM</span> t_stu;<br></code></pre></td></tr></table></figure>

<p>条件查询</p>
<ul>
<li>按条件表达式筛选，&gt; ， &lt; ， &#x3D; ， !&#x3D; ， &lt;&gt;（不等于），  &gt;&#x3D; ，&lt;&#x3D;</li>
<li>逻辑表达式筛选 &amp;&amp;（and）， || (or)， <strong>and ,or,not(取反)</strong></li>
<li>模糊查询 like，between and（not between and） ,in(列表中的值不支持通配符), is null(is not null)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 指定某一个条件进行查询</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> courseid<span class="hljs-operator">=</span><span class="hljs-number">2</span> <br><span class="hljs-comment">-- AND 是两个条件都要满足</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> courseid<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> score<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span>;<br><span class="hljs-comment">-- 查询sid为 1，6，8的记录，属于某个集合</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sid <span class="hljs-keyword">IN</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>);<br><span class="hljs-comment">-- 查询记录某个字段为null </span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span>  tb_stu <span class="hljs-keyword">WHERE</span> updatetime <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-comment">--  查询成绩在70到90区间范围内的记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> score <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">70</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">90</span>;<br><span class="hljs-comment">-- 性别非男的记录</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;m&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sgender <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;m&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<p>%：表示0或任意多个字符</p>
<p>_:任意一个字符</p>
<p>between …and… 是左右两边都闭合的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 名字由3个字母组成</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;___&#x27;</span>;<br><span class="hljs-comment">-- 名字由j 开头</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;j%&#x27;</span>;<br><span class="hljs-comment">-- 第二个字母为a 的学生记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;_a%&#x27;</span>;<br><span class="hljs-comment">-- 查询姓名中包含字母a的记录</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">WHERE</span> sname <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>去重查询&amp;起别名</p>
<ul>
<li>表或者字段还可以起别名，起别名是便于理解，如果查询的字段有重名情况使用别名可以区分，AS可省略 使用空格</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--  查询学生表中的所有性别</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> sgender <span class="hljs-keyword">FROM</span> t_stu ;<br><span class="hljs-comment">-- 给查询出的字段起别名 AS是可以省略的 使用空格</span><br><span class="hljs-keyword">SELECT</span> age <span class="hljs-keyword">AS</span> 年龄,sname <span class="hljs-keyword">AS</span> 姓名 <span class="hljs-keyword">FROM</span>  tb_stu;<br><span class="hljs-keyword">SELECT</span> sid a,sname b,sgender gender,score c <span class="hljs-keyword">FROM</span> t_stu;<br></code></pre></td></tr></table></figure>

<p>排序 order by子句可以跟单个字段，多个字段，表达式，函数，别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询所有学生记录，按成绩进行降序排序</span><br><span class="hljs-comment">-- 缺省是ASC升序</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>;<br><span class="hljs-comment">-- 查询所有学生记录，首先先按成绩进行降序排序，如果成绩相同，按名字进行升序排序</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_stu <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>, sname <span class="hljs-keyword">ASC</span>;<br></code></pre></td></tr></table></figure>

<p>组函数&#x2F;聚合函数&#x2F;分组函数(方法，已经封装好的功能直接调用)</p>
<p>用作统计使用，又称为聚合函数或者统计函数或者组函数</p>
<ul>
<li><p>聚合函数是用来做<strong>纵向运算</strong>的函数：</p>
</li>
<li><p>COUNT(字段)：统计指定列不为NULL的记录行数；一般使用count（*）统计行数</p>
</li>
<li><p>MAX(字段)：计算指定列的最大值，如果指定列是字符串类型，那么使用字符串排序运算；</p>
</li>
<li><p>MIN(字段)：计算指定列的最小值，如果指定列是字符串类型，那么使用字符串排序运算；</p>
</li>
<li><p>SUM(字段)：计算指定列的数值和，如果指定列类型不是数值类型，那么计算结果为0；</p>
</li>
<li><p>AVG(字段)：计算指定列的平均值，如果指定列类型不是数值类型，那么计算结果为0；</p>
</li>
</ul>
<p>sum,avg一般处理数值型,</p>
<p>max，min,count可以处理任意数据类型</p>
<p>分组函数都忽略了null值，可以和distinct搭配使用</p>
<p><strong>注意点：</strong>组函数可以出现多个，但是不能嵌套；如果没有group by 子句，结果集中所有行数作为一组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(employee_id) <span class="hljs-keyword">AS</span> total_employees <span class="hljs-keyword">FROM</span> salaries;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">AS</span> total_salaries <span class="hljs-keyword">FROM</span> salaries;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">AS</span> average_salary <span class="hljs-keyword">FROM</span> salaries;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">AS</span> highest_salary <span class="hljs-keyword">FROM</span> salaries;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary) <span class="hljs-keyword">AS</span> lowest_salary <span class="hljs-keyword">FROM</span> salaries;<br></code></pre></td></tr></table></figure>

<p>group by分组查询</p>
<p>查询出来的字段要求是group by后的字段，<strong>查询字段中可以出现组函数和分组字段</strong></p>
<p>group by后面可以跟聚合函数 可以起别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 	查询每个部门的部门编号和每个部门的工资和</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">SUM</span>(sal) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br><span class="hljs-comment">-- 	查询每个部门的部门编号以及每个部门的人数</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">SUM</span>(sal),<span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br><span class="hljs-comment">-- 	查询每个部门的部门编号以及每个部门员工工资大于1500的人数：</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span><span class="hljs-number">1500</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno;<br></code></pre></td></tr></table></figure>

<p>按多个字段分组，后面字段一致的为一组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 按job进行分类</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),job <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job;<br><span class="hljs-comment">-- 按job和mgr进行分类</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>),job,mgr <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job,mgr;<br></code></pre></td></tr></table></figure>

<p>having子句</p>
<p>where是对分组前进行过滤；having是对分组后进行过滤</p>
<p><strong>where中不能出现分组&#x2F;聚合函数</strong>，having中可以出现</p>
<p>where是比分组先执行的，having是在分组之后执行的；</p>
<p> having后面可以跟别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询工资总和大于9000的部门编号以及工资和：</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">sum</span>(sal)  <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">sum</span>(sal)<span class="hljs-operator">&gt;</span><span class="hljs-number">9000</span>;<br><span class="hljs-comment">-- having中使用别名</span><br><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">sum</span>(sal) 总薪资 <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> 总薪资<span class="hljs-operator">&gt;</span><span class="hljs-number">9000</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询部门员工个数大于3的，having中使用了别名</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) cc,deptno <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> cc<span class="hljs-operator">&gt;</span><span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<p>limit </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 第一位表示起始索引位置（从0开始），第二位表示个数；在分页中会使用</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">5</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">5</span>; 等价与 <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure>

<p>select完整语法使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> deptno,<span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>),<span class="hljs-built_in">sum</span>(sal) allsum <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span><span class="hljs-number">1500</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">sum</span>(sal)<span class="hljs-operator">&gt;</span><span class="hljs-number">7000</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> allsum <span class="hljs-keyword">desc</span> LIMIT <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>内连接</p>
<ul>
<li><p>多表等值连接的结果是多表的交集部分，N表连接，至少需要N-1个连接条件，没有顺序要求，一般起别名</p>
</li>
<li><p>非等值连接，只要不是等号连接的都是非等值连接</p>
</li>
</ul>
<p>外连接，有主表有从表，主表肯定会显示完整的内容</p>
<ul>
<li><p>左外连接，以左表为主</p>
</li>
<li><p>右外连接，以右表为主</p>
</li>
</ul>
<p> ON后面的条件（ON条件）和WHERE条件的区别：</p>
<ul>
<li><p>ON条件：是过滤两个链接表笛卡尔积形成中间表的约束条件。</p>
</li>
<li><p>WHERE条件：在没有ON的单表查询中，是限制物理表或者中间查询结果返回记录的约束。在两表或多表连接中是限制连接形成最终中间表的返回结果的约束。</p>
<p>建议：ON只进行连接操作，WHERE只过滤中间表的记录</p>
</li>
</ul>
<p>单纯做匹配连接用 join</p>
<p>需要得到笛卡尔积用 cross join</p>
<p>连接时需要某个表全部保留用 left join</p>
<p>自连接，通过别名，将同一张表视为多张表；同一张表中某个字段要去关联另外一个字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询员工姓名和员工的老板的名称</span><br><span class="hljs-keyword">SELECT</span> e1.empno,e1.ename,e2.empno,e2.ename  <span class="hljs-keyword">FROM</span> emp e1, emp e2 <span class="hljs-keyword">WHERE</span> e1.mgr<span class="hljs-operator">=</span>e2.empno;<br></code></pre></td></tr></table></figure>

<p>子查询(独立子查询)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询工资为20号部门平均工资的员工信息</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">WHERE</span> sal<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(sal) <span class="hljs-keyword">FROM</span> emp <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> deptno <span class="hljs-keyword">HAVING</span> deptno<span class="hljs-operator">=</span><span class="hljs-number">20</span>);<br></code></pre></td></tr></table></figure>

<p>相关子查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_name, salary<br>FROM employees e<br>WHERE salary &gt; (SELECT AVG(salary)<br>                FROM employees e2<br>                WHERE e2.department_id = e.department_id);<br></code></pre></td></tr></table></figure>

<p><strong>EXISTS</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT column1, column2, ...<br>FROM table1<br>WHERE EXISTS (subquery);<br></code></pre></td></tr></table></figure>

<p><strong>返回布尔值：</strong> <code>EXISTS</code> 子查询返回布尔值（<code>TRUE</code> 或 <code>FALSE</code>）。如果子查询返回至少一行数据，则 <code>EXISTS</code> 返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p>
<p><strong>效率高：</strong> 在很多情况下，<code>EXISTS</code> 子查询的执行效率较高，因为一旦找到符合条件的行，它就会停止扫描。</p>
<p><strong>与 <code>NOT EXISTS</code> 结合使用：</strong> <code>NOT EXISTS</code> 用于检查子查询是否没有返回任何行。</p>
<p>Exists 往往使用于要查询的字段都在一个表，其他表的字段是用来过滤的情况下，会提高效率。如果涉及获取多表字段，exists并没有优势。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT department_id, department_name<br>FROM departments d<br>WHERE EXISTS (SELECT 1<br>              FROM employees e<br>              WHERE e.department_id = d.department_id);<br><br></code></pre></td></tr></table></figure>

<p><strong>WITH</strong></p>
<p>WITH 语句在 SQL 中用于定义一个或多个公用表表达式（Common Table Expressions, CTEs）。公用表表达式是一种临时结果集，它可以在主查询中引用，使得查询更具可读性和维护性。<code>WITH</code> 语句通常用于简化复杂的查询，尤其是在需要重复使用相同的子查询时。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">WITH department_avg_salary AS (<br>    SELECT department_id, AVG(salary) AS avg_salary<br>    FROM employees<br>    GROUP BY department_id<br>)<br>SELECT e.employee_name, e.salary<br>FROM employees e<br>JOIN department_avg_salary d ON e.department_id = d.department_id<br>WHERE e.salary &gt; d.avg_salary;<br></code></pre></td></tr></table></figure>

<h2 id="集合查询"><a href="#集合查询" class="headerlink" title="集合查询"></a>集合查询</h2><ul>
<li>union–将两个表做行拼接，同时自动删除重复的行。</li>
<li>union all—将两个表做行拼接，保留重复的行。</li>
<li>使用union组合查询时，只能使用一条order by字句，它必须位于最后一条select语句之后，因为对于结果集不存在对于一部分数据进行排序，而另一部分用另一种排序规则的情况。</li>
</ul>
<p>INTERSECT（交） 和  EXCEPT（差）是MySQL 在 8.0.31 版本中开始支持</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p><strong>注意：</strong>MySQL中的+就只有运算符的功能；会试图将字符型数值转换为数值型再继续操作，转换失败则转为0；若其中有null则结果为null；字符串可以使用concat函数拼接；</p>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>除了常见的五个聚合函数（<code>COUNT</code>、<code>SUM</code>、<code>AVG</code>、<code>MIN</code>、<code>MAX</code>），MySQL 还提供了一些其他有用的聚合函数：</p>
<p><strong>GROUP_CONCAT()</strong></p>
<p>定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GROUP_CONCAT([DISTINCT] expr [,expr ...] [ORDER BY &#123;unsigned_integer | col_name | expr&#125; [ASC | DESC] [,col_name ...]] [SEPARATOR str_val])<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p><code>DISTINCT</code>：可选，用于删除重复值。</p>
</li>
<li><p><code>expr</code>：要连接的列或表达式。</p>
</li>
<li><p><code>ORDER BY</code>：可选，指定结果的排序顺序。</p>
</li>
<li><p><code>SEPARATOR</code>：可选，指定结果中使用的分隔符，默认为逗号。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 单列合并，默认以逗号分隔<br><span class="hljs-keyword">select</span> a,group_concat(name) <span class="hljs-keyword">as</span> tn <span class="hljs-keyword">from</span> t <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> id;<br># 分号<br><span class="hljs-keyword">SELECT</span> GROUP_CONCAT(name <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name <span class="hljs-keyword">ASC</span> SEPARATOR <span class="hljs-string">&#x27;; &#x27;</span>)  <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department;<br></code></pre></td></tr></table></figure>

<p><strong>STD()</strong></p>
<p>计算标准差</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT STD(salary) FROM employees GROUP BY department;<br># same as<br>SELECT STDDEV(salary) FROM employees GROUP BY department;<br></code></pre></td></tr></table></figure>

<p><strong>VARIANCE()</strong></p>
<p>计算方差</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT VARIANCE(salary) FROM employees GROUP BY department;<br># same as<br>SELECT VAR_POP(salary) FROM employees GROUP BY department;<br></code></pre></td></tr></table></figure>

<p><strong>BIT_AND(),BIT_OR(),BIT_XOR()</strong></p>
<p>按位与，或，异或</p>
<p>这些按位聚合函数 (<code>BIT_AND()</code>, <code>BIT_OR()</code>, <code>BIT_XOR()</code>) 在处理权限位、标志位、或其他需要按位操作的数据时有用。(需要搭配数据定义使用)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 查看最高权限<br>SELECT BIT_XOR(access_level) FROM user_permissions GROUP BY user_id;<br></code></pre></td></tr></table></figure>

<p> <strong>JSON_ARRAYAGG() 和 JSON_OBJECTAGG()</strong></p>
<p><code>JSON_ARRAYAGG(expr)</code>：要聚合成 JSON 数组的列或表达式。</p>
<p><code>JSON_OBJECTAGG(key_expr, value_expr)</code>：要聚合成 JSON 对象的键和值的列或表达式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT JSON_ARRAYAGG(name) FROM employees GROUP BY department;<br><br>SELECT JSON_OBJECTAGG(id, name) FROM employees GROUP BY department;<br></code></pre></td></tr></table></figure>



<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>MySQL 提供了许多常用的字符串函数，以下是一些常用字符串函数的定义、参数、默认值和返回值：</p>
<p><strong>CONCAT()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">CONCAT(str1, str2, ...)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong><code>str1, str2, ...</code>：要连接的字符串。</p>
</li>
<li><p><strong>返回值：</strong>返回连接后的字符串。如果任一参数为 <code>NULL</code>，则返回 <code>NULL</code>。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> CONCAT(<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;World&#x27;</span>);<br># Hello World<br></code></pre></td></tr></table></figure>

<p><strong>CONCAT_WS()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">CONCAT_WS(separator, str1, str2, ...)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong><code>separator</code>：要使用的分隔符。<code>str1, str2, ...</code>：要连接的字符串。</p>
</li>
<li><p><strong>返回值：</strong>返回用分隔符连接的字符串。如果任一参数为 <code>NULL</code>，则忽略该参数。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> CONCAT_WS(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;Apple&#x27;</span>, <span class="hljs-string">&#x27;Orange&#x27;</span>, <span class="hljs-string">&#x27;Banana&#x27;</span>);<br># Apple,Orange,Banana<br></code></pre></td></tr></table></figure>

<p><strong>LENGTH()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">LENGTH(str)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong><code>str</code>：要计算长度的字符串。</p>
</li>
<li><p><strong>返回值：</strong>返回字符串的字节长度。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> LENGTH(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br># <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>

<p><strong>CHAR_LENGTH()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CHAR_LENGTH</span>(str)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong><code>str</code>：要计算长度的字符串。</p>
</li>
<li><p><strong>返回值：</strong>返回字符串的字符长度。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CHAR_LENGTH</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br># <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>

<p><strong>LOWER(), UPPER()</strong></p>
<p><strong>SUBSTRING()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">SUBSTRING</span>(str, pos, len)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong><code>str</code>：源字符串。<code>pos</code>：起始位置（从1开始）<code>len</code>：要提取的长度（可选）。</p>
</li>
<li><p><strong>返回值：</strong>返回从指定位置开始，长度为 <code>len</code> 的子字符串。如果 <code>len</code> 未指定，则返回从 <code>pos</code> 开始到字符串末尾的所有字符。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">&#x27;Hello World&#x27;</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>);<br># World<br></code></pre></td></tr></table></figure>

<p><strong>TRIM()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">TRIM</span>([&#123;<span class="hljs-keyword">BOTH</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">LEADING</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">TRAILING</span>&#125; [remstr] <span class="hljs-keyword">FROM</span>] str)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong></p>
<ul>
<li><code>&#123;BOTH | LEADING | TRAILING&#125;</code>：指定要移除的字符位置，默认为 <code>BOTH</code>。</li>
<li><code>remstr</code>：要移除的字符（可选），默认为空格。</li>
<li><code>str</code>：要修剪的字符串。</li>
</ul>
</li>
<li><p><strong>返回值：</strong>返回移除指定字符后的字符串。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">TRIM</span>(<span class="hljs-string">&#x27;  Hello World  &#x27;</span>);<br># Hello World<br></code></pre></td></tr></table></figure>

<p><strong>REPLACE()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">REPLACE(str, from_str, to_str)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong></p>
<ul>
<li><code>str</code>：源字符串。</li>
<li><code>from_str</code>：要替换的子字符串。</li>
<li><code>to_str</code>：替换后的子字符串。</li>
</ul>
</li>
<li><p><strong>返回值：</strong>返回替换指定子字符串后的新字符串。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> REPLACE(<span class="hljs-string">&#x27;Hello World&#x27;</span>, <span class="hljs-string">&#x27;World&#x27;</span>, <span class="hljs-string">&#x27;MySQL&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Hello MySQL<br></code></pre></td></tr></table></figure>

<p><strong>INSTR()</strong></p>
<p><strong>定义：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">INSTR(str, substr)<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>参数：</strong></p>
<ul>
<li><code>str</code>：源字符串。</li>
<li><code>substr</code>：要查找的子字符串。</li>
</ul>
</li>
<li><p><strong>返回值：</strong>返回子字符串在源字符串中首次出现的位置（从1开始）。如果未找到，返回 0。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> INSTR(<span class="hljs-string">&#x27;Hello World&#x27;</span>, <span class="hljs-string">&#x27;World&#x27;</span>);<br># <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><p>**ABS(x)<strong>：返回x的绝对值，</strong>SQRT(x)**：返回一个数的平方根</p>
<p>**BIN(x)**：返回x的二进制，OCT返回八进制，HEX返回十六进制</p>
<p>**CEILING(x)<strong>：返回大于x的最小整数值，</strong>FLOOR(x)**：返回小于x的最大整数值</p>
<p>**POW(x,y)<strong>：返回x的y次方，</strong>EXP(x)**：返回e的x次方</p>
<p>**GREATEST(x1,x2,…,xn)<strong>：返回集合中最大的值，</strong>LEAST(x1,x2,…,xn)**：返回集合中最小的值</p>
<p>**LOG(x,y)<strong>：返回x的以y为底的对数，</strong>LN(x)**：返回x的自然对数</p>
<p>**MOD(x,y)**：返回x&#x2F;y的模（余数）</p>
<p>**PI()**：返回pi的值（圆周率）</p>
<p>**RAND()**：返回０到１内的随机值,可以通过提供一个参数(种子)使RAND()随机数生成器生成一个指定的值。</p>
<p>**ROUND(x,y)**：返回参数x的四舍五入的有y位小数的值</p>
<p>**SIGN(x)**：返回代表数字x的符号的值</p>
<p>**TRUNCATE(x,y)**：返回数字x截短为y位小数的结果</p>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p><strong>获取</strong></p>
<p>now() 返回日期+时间</p>
<p>curdate()返回系统日期，不包含时间</p>
<p>curtime() 返回当前时间，不包含日期</p>
<p><strong>提取</strong></p>
<p>YEAR(date)函数，用于提取时间字段的年返回的格式为”YYYY”</p>
<p>MONTH(date)函数，用于提取时间字段的月，返回的格式为”mm”，若月份前有0会忽略</p>
<p>MONTHNAME(date)提取月名August</p>
<p>DAY(date)函数，用于提取时间字段的日期，返回的格式为”dd”，若日期前有0会忽略</p>
<p>HOUR(date)函数，用于提取时间字段的小时，返回的格式为”HH”，若小时前有0会忽略</p>
<p>MINUTE(date)函数，用于提取时间字段的分钟，返回的格式为”ii”，若分钟前有0会忽略</p>
<p>SECOND(date)函数，用于提取时间字段的秒，返回的格式为”ss”，若秒前有0会忽略</p>
<p>DATE(date)函数，返回的格式为”YYYY-mm-dd”，</p>
<p>TIME(date)函数，用于提取时间字段的时间，例如’2020-05-26 11:11:11’，返回的格式为”HH:ii:ss”</p>
<p>WEEK(date)函数,返回时间字段是一年中的第几周（1-53）</p>
<p><strong>转换</strong></p>
<p><code>DATE_FORMAT()</code> 函数在 MySQL 中用于将日期或时间数据格式化为字符串，根据指定的格式显示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DATE_FORMAT(date, format)<br></code></pre></td></tr></table></figure>

<p><code>format</code> 字符串中可以使用以下格式说明符：</p>
<ul>
<li><p>以下是 <code>DATE_FORMAT()</code> 函数中常用的 <code>format</code> 字符串的转换表格：</p>
<table>
<thead>
<tr>
<th align="center">格式说明符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>%a</code></td>
<td align="center">缩写的星期名 (Sun..Sat)</td>
</tr>
<tr>
<td align="center"><code>%b</code></td>
<td align="center">缩写的月名 (Jan..Dec)</td>
</tr>
<tr>
<td align="center"><code>%c</code></td>
<td align="center">月，数字 (0..12)</td>
</tr>
<tr>
<td align="center"><code>%D</code></td>
<td align="center">带英文前缀的月中的天 (1st, 2nd, 3rd, …)</td>
</tr>
<tr>
<td align="center"><code>%d</code></td>
<td align="center">月中的天，数字 (00..31)</td>
</tr>
<tr>
<td align="center"><code>%e</code></td>
<td align="center">月中的天，数字 (0..31)</td>
</tr>
<tr>
<td align="center"><code>%f</code></td>
<td align="center">微秒</td>
</tr>
<tr>
<td align="center"><code>%H</code></td>
<td align="center">小时 (00..23)</td>
</tr>
<tr>
<td align="center"><code>%h</code></td>
<td align="center">小时 (01..12)</td>
</tr>
<tr>
<td align="center"><code>%I</code></td>
<td align="center">小时 (01..12)</td>
</tr>
<tr>
<td align="center"><code>%i</code></td>
<td align="center">分钟，数字 (00..59)</td>
</tr>
<tr>
<td align="center"><code>%j</code></td>
<td align="center">年中的天 (001..366)</td>
</tr>
<tr>
<td align="center"><code>%k</code></td>
<td align="center">小时 (0..23)</td>
</tr>
<tr>
<td align="center"><code>%l</code></td>
<td align="center">小时 (1..12)</td>
</tr>
<tr>
<td align="center"><code>%M</code></td>
<td align="center">月名 (January..December)</td>
</tr>
<tr>
<td align="center"><code>%m</code></td>
<td align="center">月，数字 (00..12)</td>
</tr>
<tr>
<td align="center"><code>%p</code></td>
<td align="center">AM 或 PM</td>
</tr>
<tr>
<td align="center"><code>%r</code></td>
<td align="center">时间，12 小时（hh:mm:ss AM 或 PM）</td>
</tr>
<tr>
<td align="center"><code>%S</code></td>
<td align="center">秒 (00..59)</td>
</tr>
<tr>
<td align="center"><code>%s</code></td>
<td align="center">秒 (00..59)</td>
</tr>
<tr>
<td align="center"><code>%T</code></td>
<td align="center">时间，24 小时（hh:mm:ss）</td>
</tr>
<tr>
<td align="center"><code>%U</code></td>
<td align="center">周 (00..53)，星期日是星期的第一天</td>
</tr>
<tr>
<td align="center"><code>%u</code></td>
<td align="center">周 (00..53)，星期一是星期的第一天</td>
</tr>
<tr>
<td align="center"><code>%V</code></td>
<td align="center">周 (01..53)，星期日是星期的第一天，与 <code>%X</code> 使用</td>
</tr>
<tr>
<td align="center"><code>%v</code></td>
<td align="center">周 (01..53)，星期一是星期的第一天，与 <code>%x</code> 使用</td>
</tr>
<tr>
<td align="center"><code>%W</code></td>
<td align="center">星期名 (Sunday..Saturday)</td>
</tr>
<tr>
<td align="center"><code>%w</code></td>
<td align="center">周中的天 (0&#x3D;Sunday..6&#x3D;Saturday)</td>
</tr>
<tr>
<td align="center"><code>%X</code></td>
<td align="center">年，4 位，与 <code>%V</code> 使用</td>
</tr>
<tr>
<td align="center"><code>%x</code></td>
<td align="center">年，4 位，与 <code>%v</code> 使用</td>
</tr>
<tr>
<td align="center"><code>%Y</code></td>
<td align="center">年，4 位</td>
</tr>
<tr>
<td align="center"><code>%y</code></td>
<td align="center">年，2 位</td>
</tr>
</tbody></table>
</li>
</ul>
<p>常用的格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">&#x27;%Y-%m-%d&#x27;:2024-08-02<br>&#x27;%Y-%m-%d %H:%i:%s&#x27;2024-08-02 14:35:09<br>&#x27;%W, %M %d, %Y %H:%i:%s&#x27; Friday, August 02, 2024 14:35:09<br>&#x27;%M %Y&#x27; August 2024<br>&#x27;%Y-%m-%d %r&#x27; 2024-08-02 02:30:45 PM<br>&#x27;%W&#x27; Friday<br></code></pre></td></tr></table></figure>

<p><code>STR_TO_DATE()</code> 函数用于将字符串按指定格式转换为日期。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">STR_TO_DATE(str, format)<br></code></pre></td></tr></table></figure>

<p><strong>计算</strong></p>
<p><strong>DATE_ADD</strong></p>
<p>对指定的日期加上一个时间间隔。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DATE_ADD(date, INTERVAL value unit)<br><br>SELECT DATE_ADD(&#x27;2024-08-02&#x27;, INTERVAL 10 DAY) AS new_date;<br>-- 示例结果: &#x27;2024-08-12&#x27;<br></code></pre></td></tr></table></figure>

<p><strong>DATE_SUB</strong></p>
<p>对指定的日期减去一个时间间隔。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DATE_SUB(date, INTERVAL value unit)<br><br>SELECT DATE_SUB(&#x27;2024-08-02&#x27;, INTERVAL 1 MONTH) AS new_date;<br>-- 示例结果: &#x27;2024-07-02&#x27;<br></code></pre></td></tr></table></figure>

<p><strong>DATEDIFF</strong></p>
<p>计算两个日期之间的天数差。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DATEDIFF(date1, date2)<br><br>SELECT DATEDIFF(&#x27;2024-08-02&#x27;, &#x27;2024-07-01&#x27;) AS days_diff;<br>-- 示例结果: 32<br></code></pre></td></tr></table></figure>

<p><strong>TIMESTAMPDIFF</strong>(unit, datetime1, datetime2)</p>
<p>计算两个日期或时间之间的差异，单位可以是秒、分钟、小时、天等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">TIMESTAMPDIFF(unit, datetime1, datetime2)<br><br>SELECT TIMESTAMPDIFF(DAY, &#x27;2024-07-01&#x27;, &#x27;2024-08-02&#x27;) AS days_diff;<br>-- 示例结果: 32<br></code></pre></td></tr></table></figure>

<p>单位以指定的interval为准，常用可选：</p>
<ul>
<li><p>SECOND 秒，</p>
</li>
<li><p>MINUTE 分钟（返回秒数差除以60的整数部分）</p>
</li>
<li><p>HOUR 小时（返回秒数差除以3600的整数部分）</p>
</li>
<li><p>DAY 天数（返回秒数差除以3600*24的整数部分）</p>
</li>
<li><p>MONTH 月数</p>
</li>
<li><p>YEAR 年数</p>
</li>
</ul>
<p><strong>TIMESTAMPADD</strong>(unit, value, datetime)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">TIMESTAMPADD(unit, value, datetime)<br><br>SELECT TIMESTAMPADD(MONTH, 2, &#x27;2024-08-02&#x27;) AS new_date;<br>-- 示例结果: &#x27;2024-10-02&#x27;<br></code></pre></td></tr></table></figure>



<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p><strong>MySQL 8.0</strong> 引入了窗口函数</p>
<p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">[你要的操作] <span class="hljs-keyword">OVER</span> ( <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span>  <span class="hljs-operator">&lt;</span>用于分组的列名<span class="hljs-operator">&gt;</span><br>                    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">&lt;</span>按序叠加的列名<span class="hljs-operator">&gt;</span> <br>                    <span class="hljs-keyword">ROWS</span><span class="hljs-operator">|</span><span class="hljs-keyword">RANGE</span> <span class="hljs-operator">&lt;</span>窗口滑动的数据范围<span class="hljs-operator">&gt;</span> )<br><br></code></pre></td></tr></table></figure>

<p>&lt;窗口滑动的数据范围&gt; 用来限定 [你要的操作] 所运用的数据的范围，具体有如下这些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">当前 - current row<br>之前的 - preceding<br>之后的 - following<br>无界限 - unbounded<br>表示从前面的起点 - unbounded preceding<br>表示到后面的终点 - unbounded following<br><br>举例<br>取当前行和前五行：ROWS between 5 preceding and current row --共6行<br>取当前行和后五行：ROWS between current row and 5 following --共6行<br>取前五行和后五行：ROWS between 5 preceding and 5 following --共11行<br>取当前行和前六行：ROWS 6 preceding（等价于between...and current row） --共7行<br>这一天和前面6天：RANGE between interval 6 day preceding and current row --共7天<br>这一天和前面6天：RANGE interval 6 day preceding（等价于between...and current row） --共7天<br>字段值落在当前值-100到+200的区间：RANGE between 100 preceding and 200 following  --共301个数值<br></code></pre></td></tr></table></figure>

<p>操作可以是：</p>
<p>排序函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">(<span class="hljs-number">1</span>) <span class="hljs-built_in">ROW_NUMBER</span>(): 依次排序，不会出现相同排名 <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span><br><br>(<span class="hljs-number">2</span>) <span class="hljs-built_in">RANK</span>(): 出现相同排名时，跳跃排序 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span><br><br>(<span class="hljs-number">3</span>) <span class="hljs-built_in">DENSE_RANK</span>(): 出现相同排名时，连续排序 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>

<p>前后行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">LAG</span>(column_name, <span class="hljs-keyword">offset</span>, default_value): 用于访问当前行之前的行中的值。默认是当前行前面的<span class="hljs-number">1</span>行<br><br><span class="hljs-built_in">LEAD</span>(column_name, <span class="hljs-keyword">offset</span>, default_value): 用于访问当前行之后的行中的值。默认是当前行后面的<span class="hljs-number">1</span>行<br><br># column_name: 指定要返回的列的名称。<br># <span class="hljs-keyword">offset</span> (可选): 指定要向后移动的行数。默认值为 <span class="hljs-number">1</span>。<br># default_value (可选): 如果指定的偏移量超出窗口范围，则返回的默认值。<br></code></pre></td></tr></table></figure>

<p>聚合函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">SUM</span>(), <span class="hljs-built_in">AVG</span>(), <span class="hljs-built_in">MAX</span>(), <span class="hljs-built_in">MIN</span>()<br><br># <span class="hljs-built_in">SUM</span>(column_name)<br></code></pre></td></tr></table></figure>

<p>最值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 返回窗口帧中的第一个值和最后一个值。<br><span class="hljs-built_in">FIRST_VALUE</span>(column_name)<br><br><span class="hljs-built_in">LAST_VALUE</span>(column_name)<br><br># 语法<br><span class="hljs-built_in">LAST_VALUE</span>(column_name) <span class="hljs-keyword">OVER</span> (<br>    [<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> partition_expression]<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sort_expression [<span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>]<br>    [window_frame]<br>)<br>注意window_frame (可选): 指定窗口帧范围，默认为 <span class="hljs-keyword">RANGE</span> <span class="hljs-keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="hljs-keyword">AND</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-type">ROW</span><br></code></pre></td></tr></table></figure>





<h3 id="控制流函数"><a href="#控制流函数" class="headerlink" title="控制流函数"></a>控制流函数</h3><p><strong>IF</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">IF(<span class="hljs-keyword">condition</span>, true_value, false_value) # 根据条件返回不同的值。<br><br><span class="hljs-keyword">SELECT</span> IF(<span class="hljs-number">1</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;True&#x27;</span>, <span class="hljs-string">&#x27;False&#x27;</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">result</span>;<br><span class="hljs-comment">-- 示例结果: &#x27;True&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>CASE</strong> </p>
<p>在查询中进行条件判断，返回不同的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CASE</span> expression<br>    <span class="hljs-keyword">WHEN</span> value1 <span class="hljs-keyword">THEN</span> result1<br>    <span class="hljs-keyword">WHEN</span> value2 <span class="hljs-keyword">THEN</span> result2<br>    ...<br>    <span class="hljs-keyword">ELSE</span> default_result<br><span class="hljs-keyword">END</span><br><br><span class="hljs-keyword">SELECT</span> <br>    <span class="hljs-keyword">CASE</span> <br>        <span class="hljs-keyword">WHEN</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">18</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Minor&#x27;</span><br>        <span class="hljs-keyword">WHEN</span> age <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">18</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">65</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Adult&#x27;</span><br>        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;Senior&#x27;</span><br>    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> age_group<br><span class="hljs-keyword">FROM</span> users;<br><br># 另一种<span class="hljs-keyword">case</span><br><span class="hljs-keyword">CASE</span><br><span class="hljs-keyword">WHEN</span> [conditional test <span class="hljs-number">1</span>] <span class="hljs-keyword">THEN</span>[<span class="hljs-keyword">result</span> <span class="hljs-number">1</span>]<br><span class="hljs-keyword">WHEN</span> [conditional test <span class="hljs-number">2</span>] <span class="hljs-keyword">THEN</span>[<span class="hljs-keyword">result</span> <span class="hljs-number">2</span>]<br><span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">default</span> <span class="hljs-keyword">result</span>]<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure>

<p><strong>IFNULL</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">IFNULL(expression, alt_value) #如果表达式为 <span class="hljs-keyword">NULL</span>，则返回替代值。<br><br><span class="hljs-keyword">SELECT</span> IFNULL(phone_number, <span class="hljs-string">&#x27;No Phone&#x27;</span>) <span class="hljs-keyword">AS</span> phone;<br><span class="hljs-comment">-- 如果 phone_number 为 NULL，则返回 &#x27;No Phone&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>NULLIF</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">NULLIF</span>(expression1, expression2) #如果两个表达式相等，则返回 <span class="hljs-keyword">NULL</span>，否则返回第一个表达式的值。<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">NULLIF</span>(score, <span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> adjusted_score;<br><span class="hljs-comment">-- 如果 score 为 0，则返回 NULL，否则返回 score</span><br></code></pre></td></tr></table></figure>

<p><strong>COALESCE</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">COALESCE</span>(expression1, expression2, ..., expressionN) #返回第一个非 <span class="hljs-keyword">NULL</span> 的表达式值。<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COALESCE</span>(email, <span class="hljs-string">&#x27;No Email&#x27;</span>) <span class="hljs-keyword">AS</span> contact_email;<br><span class="hljs-comment">-- 如果 email 为 NULL，则返回 &#x27;No Email&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>LOOP</strong></p>
<p>在存储过程中创建循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> loop_example()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">DECLARE</span> counter <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>    loop_start: LOOP<br>        <span class="hljs-keyword">SET</span> counter <span class="hljs-operator">=</span> counter <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>        IF counter <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br>            LEAVE loop_start;<br>        <span class="hljs-keyword">END</span> IF;<br>        <span class="hljs-keyword">SELECT</span> counter;<br>    <span class="hljs-keyword">END</span> LOOP;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure>

<p><strong>REPEAT</strong></p>
<p>在存储过程中创建循环，直到条件为真才退出循环。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> repeat_example()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">DECLARE</span> counter <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>    REPEAT<br>        <span class="hljs-keyword">SET</span> counter <span class="hljs-operator">=</span> counter <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">SELECT</span> counter;<br>    UNTIL counter <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span><br>    <span class="hljs-keyword">END</span> REPEAT;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure>

<p><strong>WHILE</strong></p>
<p>在存储过程中创建循环，条件为真时执行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> while_example()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">DECLARE</span> counter <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>    WHILE counter <span class="hljs-operator">&lt;=</span> <span class="hljs-number">5</span> DO<br>        <span class="hljs-keyword">SET</span> counter <span class="hljs-operator">=</span> counter <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">SELECT</span> counter;<br>    <span class="hljs-keyword">END</span> WHILE;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure>

<p><strong>LEAVE</strong></p>
<p>在存储过程或循环中用于退出循环或块。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> leave_example()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">DECLARE</span> counter <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>    loop_start: LOOP<br>        <span class="hljs-keyword">SET</span> counter <span class="hljs-operator">=</span> counter <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>        IF counter <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br>            LEAVE loop_start;<br>        <span class="hljs-keyword">END</span> IF;<br>        <span class="hljs-keyword">SELECT</span> counter;<br>    <span class="hljs-keyword">END</span> LOOP;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure>

<p><strong>ITERATE</strong></p>
<p>在存储过程中的循环中跳过当前迭代，继续下一个迭代。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> iterate_example()<br><span class="hljs-keyword">BEGIN</span><br>    <span class="hljs-keyword">DECLARE</span> counter <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>    loop_start: LOOP<br>        <span class="hljs-keyword">SET</span> counter <span class="hljs-operator">=</span> counter <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>        IF counter <span class="hljs-operator">=</span> <span class="hljs-number">3</span> <span class="hljs-keyword">THEN</span><br>            ITERATE loop_start;<br>        <span class="hljs-keyword">END</span> IF;<br>        <span class="hljs-keyword">SELECT</span> counter;<br>        IF counter <span class="hljs-operator">&gt;=</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br>            LEAVE loop_start;<br>        <span class="hljs-keyword">END</span> IF;<br>    <span class="hljs-keyword">END</span> LOOP;<br><span class="hljs-keyword">END</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure>









<h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><h3 id="聚合函数里使用表达式"><a href="#聚合函数里使用表达式" class="headerlink" title="聚合函数里使用表达式"></a>聚合函数里使用表达式</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">avg</span>(a2.timestamp <span class="hljs-operator">-</span>a1.timestamp )<br></code></pre></td></tr></table></figure>

<p>AVG括弧里直接加条件，过滤掉一些数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">avg</span>(rating<span class="hljs-operator">&lt;</span><span class="hljs-number">3</span>)<br># 只计算评分小于三的均值<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> product_id, <span class="hljs-built_in">SUM</span>(quantity <span class="hljs-operator">*</span> price) <span class="hljs-keyword">AS</span> total_sales <span class="hljs-keyword">FROM</span> sales <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> product_id;<br></code></pre></td></tr></table></figure>



<h3 id="条件计数"><a href="#条件计数" class="headerlink" title="条件计数"></a>条件计数</h3><p>常见的三形式</p>
<p>1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">count</span>(if(c.action<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">null</span>))<br></code></pre></td></tr></table></figure>

<p>当然，几乎所有使用if的地方可以替换为case end 表达式。</p>
<p>2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">sum</span>(if(c.action<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>))<br>#更为简洁的一种形式 <br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;confirmed&#x27;</span>) <span class="hljs-keyword">AS</span> confirmed_count <span class="hljs-keyword">FROM</span> orders;<br># 在 MySQL 中，布尔表达式会返回 <span class="hljs-number">1</span>（表示 <span class="hljs-literal">TRUE</span>）或 <span class="hljs-number">0</span>（表示 <span class="hljs-literal">FALSE</span>）<br></code></pre></td></tr></table></figure>

<p>3</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">count</span>(col_value<span class="hljs-operator">=</span><span class="hljs-string">&#x27;confirmed&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">null</span>)<br></code></pre></td></tr></table></figure>

<p>解释：</p>
<p>col_value&#x3D;’confirmed’：是一个布尔表达式，如果 <code>col_value</code> 等于 <code>&#39;confirmed&#39;</code>，则结果为 <code>TRUE</code>，否则为 <code>FALSE</code>。</p>
<ol>
<li>如果 <code>col_value=&#39;confirmed&#39;</code> 结果为 <code>TRUE</code>，那么 <code>TRUE OR NULL</code> 结果是 <code>TRUE</code>。</li>
<li>如果 <code>col_value=&#39;confirmed&#39;</code> 结果为 <code>FALSE</code>，那么 <code>FALSE OR NULL</code> 结果是 <code>NULL</code>。</li>
<li>如果 <code>col_value</code> 本身是 <code>NULL</code>，那么 <code>col_value=&#39;confirmed&#39;</code> 结果是 <code>NULL</code>，而 <code>NULL OR NULL</code> 结果还是 <code>NULL</code>。</li>
</ol>
<ul>
<li>当表达式结果为 <code>TRUE</code> 时，这一行会被计入。</li>
<li>当表达式结果为 <code>NULL</code> 时，这一行不会被计入。</li>
</ul>
<p>注意</p>
<ol>
<li>count里，只有字段值为null才不计数，其他都是计数的。</li>
<li>count 里面可以添加distinct 关键字，只计数不重复的值。</li>
</ol>
<p>建议使用<strong>第二种</strong></p>
<h3 id="使用构建的字段分组"><a href="#使用构建的字段分组" class="headerlink" title="使用构建的字段分组"></a>使用构建的字段分组</h3><p>可以使用自己构建的字段分组，以时间举例</p>
<p>字段为日期，包含年月日，如果按月分组，则需要先select 里形成月，然后group by里使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> date_format(trans_date,<span class="hljs-string">&#x27;%Y-%m&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">month</span>,country,<br><br> <span class="hljs-keyword">from</span> Transactions <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">month</span><br></code></pre></td></tr></table></figure>

<p>当然，如果查询中不需要group by 或者 order by 分组所依据的字段，也可以直接在group by &#x2F;order by里写表达式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span>  country,<br><span class="hljs-keyword">from</span> Transactions <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> date_format(trans_date,<span class="hljs-string">&#x27;%Y-%m&#x27;</span>),country<br></code></pre></td></tr></table></figure>

<h3 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h3><p><strong>LIKE 关键字</strong></p>
<ul>
<li>包含：LIKE ‘%keyword%’</li>
<li>不包含：NOT LIKE ‘%keyword%’</li>
<li>先后顺序 LIKE ‘%keyword1%keyword2%’</li>
</ul>
<p><strong>使用字符串函数</strong></p>
<ul>
<li>locate函数：Locate(substr,str) &gt; <code>0</code>，表示sub字符串包含str字符串，并返回位置，从1开始；Locate(substr,str) &#x3D; <code>0</code>，表示sub字符串不包含str字符串。</li>
<li>instr(filed,str)函数：返回str子字符串在filed字符串的第一次出现位置，为0则表示不包含该字符串</li>
</ul>
<p><strong>正则表达式</strong></p>
<p>使用regexp ‘正则表达式’</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>查询不以a，w，j开头的学生信息<br><span class="hljs-keyword">select</span> id,name <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> name regexp ‘<span class="hljs-operator">^</span>[<span class="hljs-operator">^</span>awj]’<br></code></pre></td></tr></table></figure>

<h2 id="LeetCode练习题"><a href="#LeetCode练习题" class="headerlink" title="LeetCode练习题"></a>LeetCode练习题</h2><p>高频 SQL 50 题</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>可回收且低脂的产品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> product_id <br><span class="hljs-keyword">from</span> Products <br><span class="hljs-keyword">where</span> low_fats <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Y&#x27;</span> <span class="hljs-keyword">and</span> recyclable <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Y&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>寻找用户推荐人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name <br><span class="hljs-keyword">FROM</span> Customer <br><span class="hljs-keyword">WHERE</span>  ifnull(referee_id,<span class="hljs-number">1</span>) <span class="hljs-operator">!=</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<p>大的国家</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name, population, area <br><span class="hljs-keyword">from</span> World <br><span class="hljs-keyword">where</span> area<span class="hljs-operator">&gt;=</span><span class="hljs-number">3000000</span> <span class="hljs-keyword">or</span> population<span class="hljs-operator">&gt;=</span><span class="hljs-number">25000000</span><br></code></pre></td></tr></table></figure>

<p>文章浏览 I</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> author_id id <br><span class="hljs-keyword">from</span> Views <br><span class="hljs-keyword">where</span> author_id <span class="hljs-operator">=</span> viewer_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> author_id<br></code></pre></td></tr></table></figure>

<p>无效的推文</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> tweet_id <br><span class="hljs-keyword">from</span> Tweets <br><span class="hljs-keyword">where</span> length(content) <span class="hljs-operator">&gt;</span><span class="hljs-number">15</span><br></code></pre></td></tr></table></figure>

<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>使用唯一标识码替换员工ID</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e1.unique_id,e.name <br><span class="hljs-keyword">from</span> Employees e <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> EmployeeUNI e1 <span class="hljs-keyword">on</span> e.id<span class="hljs-operator">=</span> e1.id<br></code></pre></td></tr></table></figure>

<p>产品销售分析 I</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> p.product_name,s.year,s.price <br><span class="hljs-keyword">from</span> Sales s <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Product p <span class="hljs-keyword">on</span> s.product_id <span class="hljs-operator">=</span> p.product_id;<br></code></pre></td></tr></table></figure>

<p>进店却未进行过交易的顾客</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 子查询<br><span class="hljs-keyword">select</span> customer_id, <span class="hljs-built_in">count</span>(customer_id) <span class="hljs-keyword">as</span> count_no_trans<br><span class="hljs-keyword">from</span> visits<br><span class="hljs-keyword">where</span> visit_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> visit_id <span class="hljs-keyword">from</span> transactions)<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_id;<br><br># 也可以使用<span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span><br><span class="hljs-keyword">select</span> customer_id, <span class="hljs-built_in">count</span>(customer_id) <span class="hljs-keyword">as</span> count_no_trans<br><span class="hljs-keyword">from</span> visits v<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> transactions t <span class="hljs-keyword">where</span> v.visit_id <span class="hljs-operator">=</span> t.visit_id)<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_id;<br><br># 也可以使用<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> customer_id, <span class="hljs-built_in">count</span>(customer_id) count_no_trans <br><span class="hljs-keyword">from</span> visits v<br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> transactions t <span class="hljs-keyword">on</span> v.visit_id <span class="hljs-operator">=</span> t.visit_id <br><span class="hljs-keyword">where</span> transaction_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_id;<br></code></pre></td></tr></table></figure>

<p>上升的温度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 使用date_sub函数,date_add也可以<br><span class="hljs-keyword">select</span> w1.id <span class="hljs-keyword">from</span> weather w1 <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> weather w2 <br><span class="hljs-keyword">on</span> DATE_SUB(w1.recordDate, <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>) <span class="hljs-operator">=</span>w2.recordDate <br><span class="hljs-keyword">where</span> w1.temperature<span class="hljs-operator">&gt;</span>w2.temperature<br><br># 使用datediff函数<br><span class="hljs-keyword">select</span> w2.id <span class="hljs-keyword">from</span> Weather w1  <br><span class="hljs-keyword">join</span>  Weather w2 <span class="hljs-keyword">on</span> datediff(w2.recordDate,w1.recordDate) <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <br><span class="hljs-keyword">where</span> w1.temperature <span class="hljs-operator">&lt;</span> w2.temperature;<br><br># <span class="hljs-keyword">Exists</span><br><span class="hljs-keyword">select</span> w1.id <span class="hljs-keyword">from</span> Weather w1  <br><span class="hljs-keyword">where</span> <br>	<span class="hljs-keyword">Exists</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> weather w2 <span class="hljs-keyword">where</span> date_sub(w1.recordDate, <span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>) <span class="hljs-operator">=</span> w2.recordDate <br><span class="hljs-keyword">and</span> w1.temperature<span class="hljs-operator">&gt;</span>w2.temperature)<br></code></pre></td></tr></table></figure>

<p>每台机器的进程平均运行时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.machine_id,ROUND(<span class="hljs-built_in">SUM</span>(b.timestamp<span class="hljs-operator">-</span>a.timestamp)<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),<span class="hljs-number">3</span>) <span class="hljs-keyword">as</span> processing_time <br><span class="hljs-keyword">from</span> Activity a <br><span class="hljs-keyword">join</span> Activity b <span class="hljs-keyword">on</span> a.machine_id <span class="hljs-operator">=</span> b.machine_id <span class="hljs-keyword">and</span> a.process_id <span class="hljs-operator">=</span> b.process_id <br><span class="hljs-keyword">and</span> a.activity_type <span class="hljs-operator">=</span><span class="hljs-string">&#x27;start&#x27;</span> <span class="hljs-keyword">and</span> b.activity_type<span class="hljs-operator">=</span><span class="hljs-string">&#x27;end&#x27;</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a.machine_id<br># 此题<span class="hljs-keyword">Exists</span>大概不可行<br></code></pre></td></tr></table></figure>

<p>员工奖金</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"># <span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> name ,bonus <br><span class="hljs-keyword">from</span> employee e <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> bonus b <span class="hljs-keyword">on</span> e.empId <span class="hljs-operator">=</span> b.empId <br><span class="hljs-keyword">where</span> bonus<span class="hljs-operator">&lt;</span><span class="hljs-number">1000</span> <span class="hljs-keyword">or</span> bonus <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure>

<p>学生们参加各科测试的次数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"># <span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> st.student_id, st.student_name,su.subject_name ,<span class="hljs-built_in">count</span>(e.subject_name) <span class="hljs-keyword">as</span> attended_exams <br><span class="hljs-keyword">from</span> Students st <br><span class="hljs-keyword">cross</span> <span class="hljs-keyword">join</span> Subjects su <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Examinations e <span class="hljs-keyword">on</span> st.student_id <span class="hljs-operator">=</span> e.student_id <span class="hljs-keyword">and</span> su.subject_name <span class="hljs-operator">=</span> e.subject_name<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> st.student_id, su.subject_name <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> st.student_id ,su.subject_name<br><br># <span class="hljs-keyword">with</span>语句<br><span class="hljs-keyword">WITH</span> student_with_sbjects <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span> s1.student_id, s1.student_name, s2.subject_name<br>    <span class="hljs-keyword">FROM</span> Students s1 <span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> Subjects s2<br>),<br>exam_count <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span> student_id,subject_name,<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> attended_exams<br>    <span class="hljs-keyword">FROM</span> Examinations<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> student_id,subject_name<br>)<br><span class="hljs-keyword">SELECT</span> s.student_id,s.student_name,s.subject_name,IFNULL(e.attended_exams, <span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> attended_exams<br><span class="hljs-keyword">FROM</span> student_with_sbjects s<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> exam_count e <br><span class="hljs-keyword">ON</span> s.student_id <span class="hljs-operator">=</span> e.student_id <span class="hljs-keyword">AND</span> s.subject_name <span class="hljs-operator">=</span> e.subject_name<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> s.student_id,s.subject_name<br></code></pre></td></tr></table></figure>

<p>至少有5名直接下属的经理</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> e1.name <span class="hljs-keyword">from</span> Employee e1 <span class="hljs-keyword">join</span> Employee e2 <span class="hljs-keyword">on</span> e1.id <span class="hljs-operator">=</span>e2.managerId <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> e2.managerId <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;=</span><span class="hljs-number">5</span><br><br># 使用<span class="hljs-keyword">exists</span>会很慢<br><span class="hljs-keyword">select</span> e1.name <span class="hljs-keyword">from</span> Employee e1 <br><span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span> <br>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> Employee e2 <span class="hljs-keyword">where</span> e1.id <span class="hljs-operator">=</span> e2.managerId <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> e2.managerId <span class="hljs-keyword">having</span>  <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">&gt;=</span><span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>

<p>确认率</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.user_id,<br>	round(ifNull(<span class="hljs-built_in">sum</span>(c.action <span class="hljs-operator">=</span>&quot;confirmed&quot;),<span class="hljs-number">0</span>)<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),<span class="hljs-number">2</span>)<br>	<span class="hljs-keyword">as</span> confirmation_rate<br><span class="hljs-keyword">from</span> Signups s <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Confirmations c <span class="hljs-keyword">on</span> s.user_id <span class="hljs-operator">=</span> c.user_id<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> s.user_id<br></code></pre></td></tr></table></figure>

<h3 id="聚合函数-1"><a href="#聚合函数-1" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>有趣的电影</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <br><span class="hljs-keyword">from</span> cinema <br><span class="hljs-keyword">where</span> id<span class="hljs-operator">%</span><span class="hljs-number">2</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> description <span class="hljs-operator">!=</span> <span class="hljs-string">&#x27;boring&#x27;</span> <br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> rating <span class="hljs-keyword">desc</span><br></code></pre></td></tr></table></figure>

<p>平均售价</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> Prices.product_id,<br>ifnull(ROUND(<span class="hljs-built_in">SUM</span>(price<span class="hljs-operator">*</span>units)<span class="hljs-operator">/</span><span class="hljs-built_in">SUM</span>(units),<span class="hljs-number">2</span>),<span class="hljs-number">0</span>) <br><span class="hljs-keyword">as</span> average_price<br><span class="hljs-keyword">from</span> UnitsSold <br><span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span> Prices <span class="hljs-keyword">on</span> Prices.product_id <span class="hljs-operator">=</span> UnitsSold.product_id <br><span class="hljs-keyword">and</span> purchase_date <span class="hljs-keyword">between</span> start_date <span class="hljs-keyword">and</span> end_date<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> Prices.product_id<br></code></pre></td></tr></table></figure>

<p>项目员工 I</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> p.project_id,<br>Round(<span class="hljs-built_in">avg</span>(e.experience_years),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> average_years<br><span class="hljs-keyword">from</span> Project p<br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Employee e <span class="hljs-keyword">on</span> p.employee_id<span class="hljs-operator">=</span>e.employee_id<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> p.project_id<br></code></pre></td></tr></table></figure>

<p>各赛事的用户注册率</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> contest_id,<br>ROUND((<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<span class="hljs-operator">/</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> Users))<span class="hljs-operator">*</span><span class="hljs-number">100</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> percentage <br><span class="hljs-keyword">from</span> Register <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> contest_id<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> percentage <span class="hljs-keyword">desc</span>,contest_id <span class="hljs-keyword">asc</span><br></code></pre></td></tr></table></figure>

<p>查询结果的质量和占比</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> query_name,<br>ROUND(<span class="hljs-built_in">avg</span>(rating<span class="hljs-operator">/</span>position),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> quality, <br>ROUND(<span class="hljs-built_in">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> rating<span class="hljs-operator">&lt;</span><span class="hljs-number">3</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">result</span>) <span class="hljs-operator">*</span> <span class="hljs-number">100</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> poor_query_percentage<br><span class="hljs-keyword">from</span> Queries <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> query_name <br><span class="hljs-keyword">having</span> query_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure>

<p>每月交易 I</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> date_format(trans_date,<span class="hljs-string">&#x27;%Y-%m&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-keyword">month</span>,country,<br><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> trans_count, <br><span class="hljs-built_in">sum</span>(if(state<span class="hljs-operator">=</span><span class="hljs-string">&#x27;approved&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)) <span class="hljs-keyword">as</span> approved_count,<br><span class="hljs-built_in">sum</span>(amount) <span class="hljs-keyword">as</span> trans_total_amount,<br><span class="hljs-built_in">sum</span>(if (state<span class="hljs-operator">=</span><span class="hljs-string">&#x27;approved&#x27;</span>,amount,<span class="hljs-number">0</span>)) <span class="hljs-keyword">as</span> approved_total_amount <br><span class="hljs-keyword">from</span> Transactions <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">month</span>,country<br></code></pre></td></tr></table></figure>

<p>即时食物配送 II</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 窗口函数<span class="hljs-operator">+</span>子查询<br><span class="hljs-keyword">select</span> round((<span class="hljs-built_in">sum</span>(if(order_date<span class="hljs-operator">=</span>customer_pref_delivery_date, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>))<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>))<span class="hljs-operator">*</span><span class="hljs-number">100</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> immediate_percentage <br><span class="hljs-keyword">from</span> (<br>    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<br>        <span class="hljs-built_in">row_number</span>() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> customer_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> order_date) <span class="hljs-keyword">as</span> first_order<br>    <span class="hljs-keyword">from</span> Delivery<br>) A <br><span class="hljs-keyword">where</span> A.first_order <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><br># <span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> <br>round(<span class="hljs-number">100</span><span class="hljs-operator">*</span> <span class="hljs-built_in">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> d1.order_date<span class="hljs-operator">=</span>d1.customer_pref_delivery_date <span class="hljs-keyword">and</span> d1.order_date <span class="hljs-operator">=</span> d2.first_order <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> d1.customer_id),<span class="hljs-number">2</span>) <br><span class="hljs-keyword">as</span> immediate_percentage <br><span class="hljs-keyword">from</span> Delivery d1 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span><br>(<span class="hljs-keyword">select</span> customer_id, <span class="hljs-built_in">min</span>(order_date) <span class="hljs-keyword">as</span> first_order <br><span class="hljs-keyword">from</span> Delivery <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_id) d2 <br><span class="hljs-keyword">on</span> d1.customer_id <span class="hljs-operator">=</span>d2.customer_id<br></code></pre></td></tr></table></figure>

<p>游戏玩法分析 IV</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"># <span class="hljs-keyword">join</span><br><span class="hljs-keyword">select</span> <br>round(<span class="hljs-built_in">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> a1.event_date <span class="hljs-operator">=</span> DATE_ADD(a2.first_login, <span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>) <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>)<span class="hljs-operator">/</span><span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> a1.player_id),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> fraction<br><span class="hljs-keyword">from</span> Activity a1 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> <br>(<span class="hljs-keyword">select</span> player_id, <span class="hljs-built_in">min</span>(event_date) <span class="hljs-keyword">AS</span> first_login <span class="hljs-keyword">from</span> Activity <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> player_id) a2<br><span class="hljs-keyword">on</span> a1.player_id <span class="hljs-operator">=</span> a2.player_id<br><br># 在连接的时候筛选<br><span class="hljs-keyword">SELECT</span> <br>  ROUND(<span class="hljs-built_in">COUNT</span>(a.player_id) <span class="hljs-operator">/</span><span class="hljs-built_in">COUNT</span>(m.player_id),<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> fraction <br><span class="hljs-keyword">FROM</span><br>  (<span class="hljs-keyword">SELECT</span> player_id, <span class="hljs-built_in">MIN</span>(event_date) <span class="hljs-keyword">AS</span> <span class="hljs-string">&#x27;firstD&#x27;</span> <span class="hljs-keyword">from</span> Activity <span class="hljs-keyword">Group</span> <span class="hljs-keyword">by</span> player_id) m<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <br>  Activity a<br><span class="hljs-keyword">ON</span> <br>  m.player_id <span class="hljs-operator">=</span> a.player_id <span class="hljs-keyword">AND</span> <span class="hljs-type">date</span>(m.firstD) <span class="hljs-operator">=</span> SUBDATE(<span class="hljs-type">date</span>(a.event_date), <span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>)<br><br># 使用 <span class="hljs-keyword">with</span> 搭配 窗口函数<br><br><span class="hljs-keyword">with</span> FirstLogin <span class="hljs-keyword">as</span> (<br>    <span class="hljs-keyword">select</span> player_id,<br>           event_date,<br>           <span class="hljs-built_in">min</span>(event_date) <span class="hljs-keyword">over</span> (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> player_id) <span class="hljs-keyword">as</span> first_login,<br>           <span class="hljs-built_in">lead</span>(event_date) <span class="hljs-keyword">over</span> (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> player_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> event_date) <span class="hljs-keyword">as</span> next_login<br>    <span class="hljs-keyword">from</span> Activity<br>)<br><span class="hljs-keyword">select</span> <br>    round(<span class="hljs-built_in">sum</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> next_login <span class="hljs-operator">=</span> date_add(first_login, <span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>) <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> player_id), <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> fraction<br><span class="hljs-keyword">from</span> FirstLogin<br><span class="hljs-keyword">where</span> event_date <span class="hljs-operator">=</span> first_login;<br><br></code></pre></td></tr></table></figure>

<h3 id="排序和分组"><a href="#排序和分组" class="headerlink" title="排序和分组"></a>排序和分组</h3><p>每位教师所教授的科目种类的数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select teacher_id,count(distinct subject_id) as cnt <br>from Teacher <br>group by teacher_id<br></code></pre></td></tr></table></figure>

<p>查询近30天活跃用户数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> activity_date <span class="hljs-keyword">as</span> <span class="hljs-keyword">day</span> ,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> user_id) <span class="hljs-keyword">as</span> active_users <span class="hljs-keyword">from</span> Activity <br><span class="hljs-keyword">where</span> activity_date <span class="hljs-keyword">between</span> &quot;2019-06-28&quot; <span class="hljs-keyword">and</span> &quot;2019-07-27&quot; <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> activity_date<br></code></pre></td></tr></table></figure>

<p>销售分析III</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> product_id ,product_name <br><span class="hljs-keyword">from</span> Product <br><span class="hljs-keyword">where</span> product_id <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> product_id <span class="hljs-keyword">from</span> Sales <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> product_id <br> <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(if(sale_date <span class="hljs-keyword">not</span> <span class="hljs-keyword">between</span> &quot;2019-01-01&quot; <span class="hljs-keyword">and</span> &quot;2019-03-31&quot;,<span class="hljs-number">1</span>,<span class="hljs-keyword">null</span>))<span class="hljs-operator">=</span><span class="hljs-number">0</span> )<br></code></pre></td></tr></table></figure>

<p>超过5名学生的课</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> class <span class="hljs-keyword">from</span> Courses <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> class <br><span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(student)<span class="hljs-operator">&gt;=</span><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>

<p>求关注者的数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> user_id,<br><span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> follower_id) <span class="hljs-keyword">as</span> followers_count <br><span class="hljs-keyword">from</span> Followers <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> user_id<br></code></pre></td></tr></table></figure>

<p>只出现一次的最大数字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> ifnull((<span class="hljs-keyword">select</span> num <span class="hljs-keyword">from</span> MyNumbers<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> num<br><span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(num) <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> num <span class="hljs-keyword">desc</span><br>limit <span class="hljs-number">1</span>),<span class="hljs-keyword">null</span>) <span class="hljs-keyword">as</span> num<br></code></pre></td></tr></table></figure>

<p>买下所有产品的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> customer_id <span class="hljs-keyword">from</span> Customer <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> customer_id <br><span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> product_key) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> Product)<br></code></pre></td></tr></table></figure>

<h3 id="高级查询和连接"><a href="#高级查询和连接" class="headerlink" title="高级查询和连接"></a>高级查询和连接</h3><p>每位经理的下属员工数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <br>e1.employee_id,<br>e1.name,<br><span class="hljs-built_in">count</span>(e2.reports_to) <span class="hljs-keyword">as</span> reports_count,<br>round(<span class="hljs-built_in">avg</span>(e2.age)) <span class="hljs-keyword">as</span> average_age<br><span class="hljs-keyword">from</span> Employees e1 <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Employees e2 <span class="hljs-keyword">on</span> e1.employee_id <span class="hljs-operator">=</span> e2.reports_to<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> e1.employee_id <br><span class="hljs-keyword">having</span> reports_count <span class="hljs-operator">&gt;</span><span class="hljs-number">0</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> e1.employee_id<br></code></pre></td></tr></table></figure>

<p>员工的直属部门</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> employee_id,department_id<br><span class="hljs-keyword">from</span> Employee <br><span class="hljs-keyword">where</span> primary_flag <span class="hljs-operator">=</span> &quot;Y&quot;<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> employee_id<br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> employee_id,department_id<br><span class="hljs-keyword">from</span> Employee <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> employee_id<br><span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(department_id) <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p> 判断三角形</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> x,y,z ,<br>if(x<span class="hljs-operator">+</span>y<span class="hljs-operator">&gt;</span>z <span class="hljs-keyword">and</span> y<span class="hljs-operator">+</span>z<span class="hljs-operator">&gt;</span>x <span class="hljs-keyword">and</span> x<span class="hljs-operator">+</span>z<span class="hljs-operator">&gt;</span>y,&quot;Yes&quot;,&quot;No&quot;) <span class="hljs-keyword">as</span> triangle <br><span class="hljs-keyword">from</span> Triangle <br></code></pre></td></tr></table></figure>

<p>连续出现的数字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">distinct</span> a.num <span class="hljs-keyword">as</span> ConsecutiveNums<br><span class="hljs-keyword">from</span> Logs <span class="hljs-keyword">as</span> a <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Logs <span class="hljs-keyword">as</span> b <span class="hljs-keyword">on</span> a.id <span class="hljs-operator">=</span> b.id<span class="hljs-number">-1</span><br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Logs <span class="hljs-keyword">as</span> c <span class="hljs-keyword">on</span> a.id <span class="hljs-operator">=</span> c.id<span class="hljs-number">-2</span><br><span class="hljs-keyword">where</span> a.num <span class="hljs-operator">=</span> b.num <span class="hljs-keyword">and</span> b.num <span class="hljs-operator">=</span> c.num<br></code></pre></td></tr></table></figure>

<p>指定日期的产品价格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 注意这种写法是错误的，因为<span class="hljs-keyword">case</span>并不能起到组函数的作用，它会逐一检查每一行，可能会记录覆盖。<br><span class="hljs-keyword">WITH</span> prices <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span> <br>        product_id, <br>        new_price, <br>        change_date,<br>        <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> product_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> change_date <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> ranking <br>    <span class="hljs-keyword">FROM</span> Products<br>)<br><span class="hljs-keyword">SELECT</span> <br>    p.product_id,<br>    <span class="hljs-keyword">CASE</span> <br>        <span class="hljs-keyword">WHEN</span> p.change_date <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2019-08-16&#x27;</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">10</span> <br>        <span class="hljs-keyword">ELSE</span> (<br>            <span class="hljs-keyword">SELECT</span> pr.new_price <br>            <span class="hljs-keyword">FROM</span> prices pr <br>            <span class="hljs-keyword">WHERE</span> pr.product_id <span class="hljs-operator">=</span> p.product_id <span class="hljs-keyword">AND</span> pr.ranking <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>        )<br>    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> price<br><span class="hljs-keyword">FROM</span> <br>    Products p<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <br>    p.product_id<br>    <br># 正确<br><span class="hljs-keyword">select</span> product_id,new_price <span class="hljs-keyword">as</span> price<br><span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<span class="hljs-built_in">row_number</span>() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> product_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> change_date <span class="hljs-keyword">desc</span>)<br><span class="hljs-keyword">as</span> ranking <span class="hljs-keyword">from</span> Products <span class="hljs-keyword">where</span> change_date<span class="hljs-operator">&lt;=</span>&quot;2019-08-16&quot;) <span class="hljs-keyword">as</span> P <span class="hljs-keyword">where</span> ranking <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> product_id,<span class="hljs-number">10</span> <span class="hljs-keyword">from</span> Products <span class="hljs-keyword">where</span> product_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> product_id <span class="hljs-keyword">from</span> Products <span class="hljs-keyword">where</span> change_date<span class="hljs-operator">&lt;=</span>&quot;2019-08-16&quot;)<br><br><br></code></pre></td></tr></table></figure>

<p>最后一个能进入巴士的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> person_name <br><span class="hljs-keyword">from</span> <br>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>,<span class="hljs-built_in">sum</span>(weight) <span class="hljs-keyword">over</span> (<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> turn) <span class="hljs-keyword">as</span> total_weight <span class="hljs-keyword">from</span> Queue) q <br><span class="hljs-keyword">where</span> q.total_weight<span class="hljs-operator">&lt;=</span><span class="hljs-number">1000</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> q.total_weight <span class="hljs-keyword">desc</span> limit <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>按分类统计薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> &quot;Low Salary&quot; <span class="hljs-keyword">as</span> category,<span class="hljs-built_in">sum</span>(income<span class="hljs-operator">&lt;</span><span class="hljs-number">20000</span>) <span class="hljs-keyword">as</span> accounts_count <span class="hljs-keyword">from</span> Accounts<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><span class="hljs-keyword">select</span> &quot;Average Salary&quot; <span class="hljs-keyword">as</span> category,<span class="hljs-built_in">sum</span>(income<span class="hljs-operator">&gt;=</span><span class="hljs-number">20000</span> <span class="hljs-keyword">and</span> income<span class="hljs-operator">&lt;=</span><span class="hljs-number">50000</span>) <span class="hljs-keyword">as</span> accounts_count <span class="hljs-keyword">from</span> Accounts<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><span class="hljs-keyword">select</span> &quot;High Salary&quot; <span class="hljs-keyword">as</span> category,<span class="hljs-built_in">sum</span>(income<span class="hljs-operator">&gt;</span><span class="hljs-number">50000</span>) <span class="hljs-keyword">as</span> accounts_count <span class="hljs-keyword">from</span> Accounts<br></code></pre></td></tr></table></figure>

<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>上级经理已离职的公司员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> employee_id <br><span class="hljs-keyword">from</span> Employees <br><span class="hljs-keyword">where</span> salary <span class="hljs-operator">&lt;</span><span class="hljs-number">30000</span> <br><span class="hljs-keyword">and</span> manager_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> employee_id <span class="hljs-keyword">from</span> Employees)<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> employee_id<br></code></pre></td></tr></table></figure>

<p>换座位</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s1.id,ifnull(s2.student,s1.student) <span class="hljs-keyword">as</span> student <span class="hljs-keyword">from</span> Seat s1 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span><br>(<span class="hljs-keyword">select</span> id ,student,if(id<span class="hljs-operator">%</span><span class="hljs-number">2</span><span class="hljs-operator">=</span><span class="hljs-number">0</span>,id<span class="hljs-number">-1</span>,id<span class="hljs-operator">+</span><span class="hljs-number">1</span>) <span class="hljs-keyword">as</span> change_id <span class="hljs-keyword">from</span> Seat ) s2  <br><span class="hljs-keyword">on</span> s1.id <span class="hljs-operator">=</span> s2.change_id<br><br># 窗口函数<br><span class="hljs-keyword">SELECT</span><br>    id,<br>    <span class="hljs-keyword">CASE</span> <br>        <span class="hljs-keyword">WHEN</span> id <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> prev_student<br>        <span class="hljs-keyword">WHEN</span> id <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> next_student<br>    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> student<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span><br>        id,<br>        student,<br>        <span class="hljs-built_in">LAG</span>(student, <span class="hljs-number">1</span>, student) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id) <span class="hljs-keyword">AS</span> prev_student,<br>        <span class="hljs-built_in">LEAD</span>(student, <span class="hljs-number">1</span>, student) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id) <span class="hljs-keyword">AS</span> next_student<br>    <span class="hljs-keyword">FROM</span> Seat<br>) <span class="hljs-keyword">AS</span> subquery;<br><br># 三次自连接<br><span class="hljs-keyword">SELECT</span><br>    s1.id,<br><span class="hljs-keyword">CASE</span><br>        <span class="hljs-keyword">WHEN</span> s1.id <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> s2.student <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">THEN</span><br>        s2.student <br>        <span class="hljs-keyword">WHEN</span> s1.id <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> s2.student <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">THEN</span><br>        s1.student <br>        <span class="hljs-keyword">ELSE</span> s3.student <br>    <span class="hljs-keyword">END</span> student <br><span class="hljs-keyword">FROM</span><br>    Seat s1<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Seat s2 <span class="hljs-keyword">ON</span> s1.id <span class="hljs-operator">=</span> s2.id <span class="hljs-operator">-</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> Seat s3 <span class="hljs-keyword">ON</span> s1.id <span class="hljs-operator">=</span> s3.id <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure>

<p>电影评分</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">(<span class="hljs-keyword">select</span> u.name <span class="hljs-keyword">as</span> results <span class="hljs-keyword">from</span> MovieRating mr <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Users u <span class="hljs-keyword">on</span> mr.user_id<span class="hljs-operator">=</span>u.user_id<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> mr.user_id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">count</span>(mr.movie_id) <span class="hljs-keyword">desc</span> ,u.name limit <span class="hljs-number">1</span>)<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br>(<span class="hljs-keyword">select</span> m.title <span class="hljs-keyword">as</span> results <span class="hljs-keyword">from</span> MovieRating mr <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Movies m <span class="hljs-keyword">on</span> <br>mr.movie_id <span class="hljs-operator">=</span> m.movie_id<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">month</span>(created_at) <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">year</span>(created_at) <span class="hljs-operator">=</span><span class="hljs-number">2020</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> mr.movie_id<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">AVG</span>(mr.rating) <span class="hljs-keyword">desc</span>,m.title limit <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>



<p>2016年的投资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> Round(<span class="hljs-built_in">sum</span>(tiv_2016),<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> tiv_2016 <span class="hljs-keyword">from</span> Insurance <br><span class="hljs-keyword">where</span> pid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> pid <span class="hljs-keyword">from</span> Insurance <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> lat,lon <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(pid) <span class="hljs-operator">=</span> <span class="hljs-number">1</span>) <br><span class="hljs-keyword">and</span> pid <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> pid <span class="hljs-keyword">from</span> Insurance <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> tiv_2015 <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(pid) <span class="hljs-operator">=</span> <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>

<p>部门工资前三高的所有员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> Department,Employee,Salary <span class="hljs-keyword">from</span><br>(<br>    <span class="hljs-keyword">select</span> d.name <span class="hljs-keyword">as</span> Department,e.name <span class="hljs-keyword">as</span> Employee,e.salary <span class="hljs-keyword">as</span> Salary <br>    ,<span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">over</span> (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> d.id <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">desc</span>) <span class="hljs-keyword">as</span> order_salary <br>    <span class="hljs-keyword">from</span> Employee e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> department d <span class="hljs-keyword">on</span> e.departmentId <span class="hljs-operator">=</span> d.id<br>) p <br><span class="hljs-keyword">where</span> order_salary<span class="hljs-operator">&lt;=</span><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>



<h3 id="字符串函数-正则表达式"><a href="#字符串函数-正则表达式" class="headerlink" title="字符串函数 &#x2F; 正则表达式"></a>字符串函数 &#x2F; 正则表达式</h3><p>修复表中的名字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> user_id ,concat(<span class="hljs-built_in">upper</span>(substr(name,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<span class="hljs-built_in">lower</span>(substr(name,<span class="hljs-number">2</span>))) <span class="hljs-keyword">as</span> name <br><span class="hljs-keyword">from</span> Users<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> user_id<br></code></pre></td></tr></table></figure>

<p>患某种疾病的患者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Patients <span class="hljs-keyword">where</span> conditions regexp <span class="hljs-string">&#x27;\\bDIAB1.*&#x27;</span><br><br># \\b：这是一个单词边界，确保匹配的是以 DIAB1 开头的单词。由于在 <span class="hljs-keyword">SQL</span> 查询中反斜杠需要转义，因此使用两个反斜杠 \\ 来表示一个实际的反斜杠 \。<br># .<span class="hljs-operator">*</span>：表示匹配零个或多个任意字符，意味着 DIAB1 后面可以跟随任何内容（或没有内容）。<br># 具体来说，它会匹配以下情况：DIAB1 出现在 conditions 列的开头。DIAB1 前面有空格或其他分隔符。<br></code></pre></td></tr></table></figure>

<p>删除重复的电子邮箱</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> Person <span class="hljs-keyword">where</span> id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<br>    <span class="hljs-keyword">select</span> a.id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(id) <span class="hljs-keyword">as</span> id <span class="hljs-keyword">from</span> Person <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> email) <span class="hljs-keyword">as</span> a<br>)<br></code></pre></td></tr></table></figure>

<p>第二高的薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<br>    <span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> salary <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> salary <span class="hljs-keyword">desc</span> limit <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br>) <span class="hljs-keyword">as</span> SecondHighestSalary;<br></code></pre></td></tr></table></figure>

<p>按日期分组销售产品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> sell_date,<br><span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> product) <span class="hljs-keyword">as</span> num_sold,<br>group_concat(<span class="hljs-keyword">distinct</span> product <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> product separator &quot;,&quot;)  <span class="hljs-keyword">as</span> products <br><span class="hljs-keyword">from</span> Activities <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sell_date <br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sell_date<br></code></pre></td></tr></table></figure>

<p>列出指定时间段内所有的下单产品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> p.product_name,<br><span class="hljs-built_in">sum</span>(o.unit) <span class="hljs-keyword">as</span> unit <br><span class="hljs-keyword">from</span> Orders o <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> Products p <span class="hljs-keyword">on</span> o.product_id  <span class="hljs-operator">=</span> p.product_id<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">Month</span>(order_date) <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">year</span>(order_date) <span class="hljs-operator">=</span><span class="hljs-number">2020</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> p.product_id <br><span class="hljs-keyword">having</span> unit<span class="hljs-operator">&gt;=</span><span class="hljs-number">100</span><br></code></pre></td></tr></table></figure>

<p>查找拥有有效邮箱的用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <br><span class="hljs-keyword">from</span> Users <br><span class="hljs-keyword">where</span> mail regexp <span class="hljs-string">&#x27;^[a-zA-Z][a-zA-Z0-9_.-]*\\@leetcode\\.com$&#x27;</span><br># <span class="hljs-operator">^</span>：匹配字符串的开头。<br># [a<span class="hljs-operator">-</span>zA<span class="hljs-operator">-</span>Z]：匹配一个字母字符（大写或小写），即邮箱地址必须以一个字母开头。<br># [a<span class="hljs-operator">-</span>zA<span class="hljs-operator">-</span>Z0<span class="hljs-number">-9</span>_.<span class="hljs-operator">-</span>]<span class="hljs-operator">*</span>：匹配零个或多个字母、数字、下划线 _、点 . 或连字符 <span class="hljs-operator">-</span>。这表示邮箱地址的本地部分（在 @ 之前的部分）可以包含这些字符。<br># \@：匹配一个 @ 字符。由于 @ 是一个特殊字符，需要通过 \\ 进行转义。在 <span class="hljs-keyword">SQL</span> 中，反斜杠本身也需要转义，因此这里用了 \\@。<br># leetcode\.com：匹配 leetcode.com 字符串。由于点 . 在正则表达式中也是一个特殊字符（表示匹配任意单个字符），所以需要用 \\. 进行转义。在 <span class="hljs-keyword">SQL</span> 中，反斜杠本身也需要转义，因此这里用了 \\.com。<br># $：匹配字符串的结尾。<br></code></pre></td></tr></table></figure>


      </div>
    </div>
    
      <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({"startOnload":true});
        }
      </script>
    
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2024/07/21/Z%E4%B8%8E%E8%BF%87%E5%8E%BB%EF%BC%881%EF%BC%89/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>Z与过去（1）</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2024/07/20/%E5%BA%8F%E8%A8%80/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
      </div>
      序言
    </a>
  
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">朋友</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://www.mizu.ink/" >Mizu</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MzkxNTYxODQ1NQ" >神龟先生</a>
                  </div>
                
                
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <a class="foot-link" href="https://github.com/FindingWatch" target="_blank">
                      <img alt="link" height="20px" width="20px" src="/images/logo-github.svg" />
                    </a>
                  </div>
                
                  <div class="text">
                    <a class="foot-link" href="https://space.bilibili.com/38815605?spm_id_from=333.1007.0.0" target="_blank">
                      <img alt="link" height="20px" width="20px" src="/images/bilibili.svg" />
                    </a>
                  </div>
                
              </div>
            </div>
          
          
        </div>
        <div class="copyright">
          <span>© 2024 · Watch</span>
          
        </div>
      </div>
    </div>
    
      <script src="https://unpkg.com/js-polyfills@0.1.43/es6.js"></script>
      <script id="MathJax-script"
              async
              src="https://www.unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    
    
      <script src="/js/search.js"></script>
      <script>searchInitialize("/search.json")</script>
    
    
  

  </body>
</html>
